<!DOCTYPE html>
<html>
  <header>
    <a href="/dashboard">Back</a>
  </header>
  <body>
    <iframe id="database"></iframe>
    <div id="container">
      Fetching Data...
    </div>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script>
      var embed = document.getElementById("database");
      var pusher = new Pusher('127a8a2ca4a3676b2df9', {
        cluster: 'us2',
        authEndpoint: 'https://DimgreyZigzagProjector--five-nine.repl.co/pusher/auth',
     });
      var database = document.getElementById("database");
      function list(item) {
        var channel = pusher.subscribe('database-return2');
        channel.bind('list', function(response) {
          console.log(response.data);
          messages = response.data;
          console.log('list');
          pusher.unsubscribe('database-return2');
        });
        database.src='https://starlitedatabase.cs641311.repl.co/?task=list&item='+item;
      }
      list('playerdata');
      setTimeout(renderResults, 3000);
      function renderResults() {
        var l = 0;
        while (l<messages.length) {
          var t = document.createElement("DIV");
          t.innerHTML = messages[l]["increedible-tanks"].username + ": "+messages[l]["increedible-tanks"].coins;
          document.getElementById('container').innerHTML = "";
          document.getElementById('container').appendChild(t);
          l++;
        }
      }
    </script>
  </body>
</html>
