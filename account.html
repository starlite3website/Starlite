<head>
  <title>Starlite | Accounts</title>
  <link rel="shortcut icon"href="/starlite-logo.png"type="image/png">
</head>
<iframe src="" id="database" visibility="hidden" display="hidden" width="0" height="0"></iframe>
<script src="https://js.pusher.com/7.0/pusher.min.js"></script>
<script>
  var database = document.getElementById("database");
  var pusher = new Pusher('127a8a2ca4a3676b2df9', {
    cluster: 'us2',
    authEndpoint: 'https://DimgreyZigzagProjector--five-nine.repl.co/pusher/auth',
  });
  var data;
  function get(username) {
    var channel = pusher.subscribe('database-return');
    channel.bind('get', function(response) {
      data = response;
      pusher.unsubscribe('database-return');
    });
    database.src='https://starlitedatabase.cs641311.repl.co/?task=get&username='+username;
  }
  function update(username, key, value) {
    database.src="https://starlitedatabase.cs641311.repl.co/?task=update&username="+username+"&key="+key+"&value="+value;
  }
  function newAccount(username, password) {
    database.src="https://starlitedatabase.cs641311.repl.co/?task=new&username="+username+"&password="+password;
  }
</script>
<div id="form">
  <img src="/starlite-logo.png"/>
  <h1>Sign up/Login</h1>
  <div id="input">
    <b>Username:</b>
    <input type="text"id="usernameForm"/>
  </div>
  <div id="input">
    <b>Password:</b>
    <input type="password"id="passwordForm"/>
  </div>
  <div id="input">
    <a href="/termsofservice"><b>Terms of Service:</b></a>
    <input type="checkbox"id="termsofservice"/>
  </div>
  <button id="submit">Submit</button>
  <button id="newaccount">New Account</button>
  <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
  <script> 
    var submit=document.getElementById("submit");
    var newaccount=document.getElementById("newaccount");
    submit.addEventListener("click", function() {
      var usernameInput=document.getElementById("usernameForm");
      var passwordInput=document.getElementById("passwordForm");
      get(usernameInput.value);
      setTimeout(function() {
        if (data[0].password == passwordInput.value) {
          sessionStorage.setItem("username",usernameInput.value);
          window.location.href="/dashboard";
        }
      }, 2000);  
    });
    newaccount.addEventListener("click",function(){
      var usernameInput=document.getElementById("usernameForm");
      var passwordInput=document.getElementById("passwordForm");
      get(usernameInput.value);
      setTimeout(function() {
        if (data[0] == []) {
          alert("Account Taken :(");
        } else {
          newAccount(usernameInput.value, passwordInput.value);
          sessionStorage.username = usernameInput.value;
          window.location.href = "/dashboard";
        }
      }, 2000);
    });
  </script>
  <style>
      img{
        width:100px;
        height:100px;
        margin-left:auto;
      }
    @font-face {
      font-family: "starfont";
      src: url(starlite3.ml/FFFFORWA[1].TTF);
    }
      * {
        font-family: starfont;
      }
      body {
        background-color: orangered;
      }
      #form{
        width: 30%;
        text-align: center;
        display:block;
        padding:30px; 
        margin-left:35%;
        margin-right:35%;
        margin-top:5%;
        border:1px solid black;
        background-color: white;
      }
      h1,input{
        display:block;
        margin-bottom:10px;
      }
      button{
        display:block;
        border:2px white;
        font-size:20px;
        padding:12px;
        background-color:white;
        color:black;
      }
      button:hover{
        transition-duration:1.5s;
        background-color:orangered;
        color:white;
        border-color:orangered;
      }
      img{
        margin: auto;
        margn-bottom: 5%;
        display: block;
      }
      h1,a,button,b,input{
        margin: auto;
        margin-top: 5%;
        display: inline;
      }
    #input {
      display: block;
    }
    </style>
  </div>
</html>
