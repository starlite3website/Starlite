<html>
  <head>
    <link rel="shortcut icon"href="/starlite-logo.png"type="image/png">
    <title>Starlite | Chat</title>
  </head>
<div id='wall'></div>
<script>
  window.setTimeout(function() {
    document.getElementById('wall').style.visibility = 'hidden';
    document.getElementById('animate').style.visibility = 'hidden';
  }, 3000);
</script>
<div id="animate">
</div>
<style>
    #wall {
      position: fixed;
      background-color: white;
      width: 100%;
      height: 100%;
      top: 0px;
      left: 0px;
      z-index: 100;
    }
    #animate {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 30px;
      height: 30px;
      margin-top:-15px;
      margin-left:-15px;
      border: 1px solid orangered;
      background-color: orangered;
      border-radius: 15px;
      animation: animation 2s infinite;
      z-index:101;
    }
    @keyframes animation {
      0% {
        margin-left: -15px;
        margin-top: -65px;
      }
      25% {
        margin-left: 35px;
        margin-top: -15px;
        background-color: white;
      }
      50% {
        margin-left: -15px;
        margin-top: 35px;
        background-color: orangered;
      }
      75% {
        margin-left: -65px;
        margin-top: -15px;
        background-color: white;
      }
      100% {
        margin-left: -15px;
        margin-top: -65px;
      }
    }
</style>
  <div id="messages">
  </div>
  <div>
    <textarea placeholder="Message" id="message"></textarea>
    <input type="text" placeholder="To" id="from"/>
    <button id="submit">Send Message</button>
    <h3> How To Use </h3>
    <p><b>Send Message:</b> Type message in MESSAGE box, and a username in TO box.</p>
    <p><b>Send to Everyone:</b> Type public in the TO box.</p>
    <p><b>Send to Muliple People:</b> Type : or colons in between usernames.</p>
  </div>
  <style>
    * {
      font-family: Courier;
    }
    div {
      display: block;
      font-family: Courier;
    }
    textarea {
      margin-bottom: 10px;
      margin-top: 10px;
      width: 200px;
      height: 100px;
      display: block;
      background-color: white;
      font-family: Courier;
      border: 1px solid black;
      padding: 10px;
    }
    input {
      margin-bottom: 10px;
      width: 200px;
      display: block;
      font-family: Courier;
      background-color: white;
      border: 1px solid back;
      padding: 10px;
    }
    button {
      font-family: Courier;
      color: white;
      background-color: orange;
      border: 1px solid orange;
      padding: 5px;
      border-radius: 20px;
    }
  </style>
  <h1>Adam and Chase email me at 3foes@mail.com</h1>
  <iframe src="" id="database" visibility="hidden" display="hidden" width="0" height="0"></iframe>
  <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
  <script>
  var database = document.getElementById("database");
  var pusher = new Pusher('127a8a2ca4a3676b2df9', {
    cluster: 'us2',
    authEndpoint: 'https://DimgreyZigzagProjector--five-nine.repl.co/pusher/auth',
  });
  function get(username) {
    var channel = pusher.subscribe('database-return');
    channel.bind('get', function(response) {
      messages = JSON.parse(response.data[0].playerdata)["increedible-tanks"];
      pusher.unsubscribe('database-return');
    });
    database.src='https://starlitedatabase.cs641311.repl.co/?task=get&username='+username;
  }
  function update(username, key, value) {
    database.src="https://starlitedatabase.cs641311.repl.co/?task=update&username="+username+"&key="+key+"&value="+value;
  }
  get(sessionStorage.username);
  var d = [], e = [], interval, socket = new WebSocket('wss://connect.websocket.in/v3/1?apiKey=c37MW77TpY8GDiA4yfQPegQUtlFUJkK5d2i1Nrkuk87aCjfwtsxTxHPgKdLn');;
  window.setTimeout(function() {
    interval = window.setInterval(updateChat, 1000);
    socket.onmessage = function(e) {
      updateChat(JSON.parse(e.data));
    }
  }, 2000);
  function updateChat(m) {
    if (m != undefined) {
      messages = messages.concat(m);
    }
    var l = 0;
    while (l<e.length) {
      e[l].remove();
      l++;
    }
    d = [];
    var l = 0;
    while (l<messages.length) {
      if (messages[l].send == sessionStorage.username || messages[l].user == sessionStorage.username || messages[l].user == "public" || sessionStorage.username == "admin") {
        var t = document.createElement("DIV");
        t.style = "margin-left:5%;margin-right:44%;margin-bottom:1%;margin-top:1%;padding:1%;border:1px solid black;word-wrap:break-word;width:50%;";
        if (sessionStorage.username == JSON.parse(messages)[l].send || sessionStorage.username == "admin") {
          var q = document.createElement("BUTTON");
          q.setAttribute("id", l);
          q.setAttribute("onclick", 't=messages;var index = this.id; if (index>-1) {t.splice(index,1)}; update(sessionStorage.username, "messages", t);');
          q.innerHTML = "Delete";
          t.innerHTML = q.outerHTML+" "+messages[l].send+": <div><b>"+messages[l].message+"</b></div>to:"+messages[l].user+" at: "+messages[l].timestamps;
        } else {
          t.innerHTML = messages[l].send+": <b>"+messages[l].message+"</b> to: "+messages[l].user+" at: "+messages[l].timestamps;
        } 
        document.getElementById("messages").appendChild(t);
        e.push(t);
        d.push(t);
      } 
      l++;
    }
  }
  document.getElementById("submit").addEventListener("click", send);
  function send() {
    if (document.getElementById("from").value!=""&&document.getElementById("message").value!="") {
      var m = document.getElementById("message").value;
      if (m.replace(/\s/g,'').toLowerCase().includes("damn") || m.replace(/\s/g,'').toLowerCase().includes("shit") || m.replace(/\s/g,'').toLowerCase().includes("fuck") || m.replace(/\s/g,'').toLowerCase().includes("ass") || m.replace(/\s/g,'').toLowerCase().includes("bitch") || m.replace(/\s/g,'').toLowerCase().includes("cunt")) { // CHASE Put in the 'words' in the includes("<here>") area (delete this after you do it)
        alert("Cuss Word Detected! We do not permit any cuss words. If you disagree that you have not cuss words in your message report to 'admin' in chat");
      } else {
        socket.send(JSON.stringify({message:document.getElementById("message").value,user:document.getElementById("from").value,send:sessionStorage.username,timestamps:new Date()}));
        update(sessionStorage.username, 'messages', JSON.stringify(messages.concat({message:document.getElementById("message").value,user:document.getElementById("from").value,send:sessionStorage.username,timestamps:new Date()})));
        updateChat({message:document.getElementById("message").value,user:document.getElementById('from').value,send:sessionStorage.username,timestamps:new Data()});       
      }
      document.getElementById("message").value = "";
      document.getElementById("from").value = "";
    }
  }
  </script>
</html>
