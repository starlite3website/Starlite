<html>
  <head>
    <link rel="shortcut icon"href="/starlite-logo.png"type="image/png">
    <title>Starlite | Chat</title>
  </head>
<div id='wall'></div>
<script>
  window.setTimeout(function() {
    document.getElementById('wall').style.visibility = 'hidden';
    document.getElementById('animate').style.visibility = 'hidden';
  }, 7000);
</script>
<div id="animate">
</div>
<style>
    #wall {
      position: fixed;
      background-color: white;
      width: 100%;
      height: 100%;
      top: 0px;
      left: 0px;
      z-index: 100;
    }
    #animate {
      position: absolute;
      left: 45%;
      top: 40%;
      margin-top: 50px;
      margin-left:0px;
      width: 30px;
      height: 30px;
      border: 1px solid orange;
      background-color: orange;
      border-radius: 15px;
      animation: animation 3s infinite;
      z-index:101;
    }
    @keyframes animation {
      0% {
        margin-top: 50px;
        margin-left:0px;
      }
      25% {
        margin-left: 50px;
        margin-top: 0px;
        background-color: white;
      }
      50% {
        margin-left: 100px;
        margin-top: 50px;
        background-color: orange;
      }
      75% {
        margin-left: 50px;
        margin-top: 100px;
        background-color: white;
      }
      100% {
        margin-top: 50px;
        margin-left: 0px;
      }
    }
</style>
  <div id="messages">
  </div>
  <div>
    <textarea placeholder="Message" id="message"></textarea>
    <input type="text" placeholder="To" id="from"/>
    <button id="submit">Send Message</button>
  </div>
  <style>
    span {
      display: block;
      font-family: Courier;
    }
    textarea {
      margin-bottom: 10px;
      margin-top: 10px;
      width: 200px;
      height: 100px;
      display: block;
      background-color: white;
      font-family: Courier;
      border: 1px solid black;
      padding: 10px;
    }
    input {
      margin-bottom: 10px;
      width: 200px;
      display: block;
      font-family: Courier;
      background-color: white;
      border: 1px solid back;
      padding: 10px;
    }
    button {
      font-family: Courier;
      color: white;
      background-color: orange;
      border: 1px solid orange;
      padding: 5px;
      border-radius: 20px;
    }
  </style>
  <iframe src="" id="database" width="500" height="500"></iframe>
<script>
  var embed = document.getElementById("database");
  var o = [];
    function update(range, value) {
      embed.src="https://script.google.com/a/macros/gilbertschools.net/s/AKfycbwp4cBG-osQbiGUbuhq8nBrDyLUryqlP1IhZfxr6HqjWt67NbPb/exec?type=2&range="+range+"&value="+value;
    }
    function get(one, two) {
      getUrlJSON("https://spreadsheets.google.com/feeds/list/1bCZMrjfLvQbQ8C6LIqQMNjJ-Hofn9l5BbeRogBGjBjU/1/public/basic?alt=json");
    }
    function getUrlJSON(url) {
      getJSON(url, after); 
    }
    function after(err, data) {
      if (err !== null) {
        console.log('Something went wrong: ' + err);
      } else {
      var l = 0;
        while (l<data.feed.entry.length) {
          if (data.feed.entry[l].content.$t != "") {
            o.push(data.feed.entry[l].content.$t.split(", ")); 
          }
            l++;
          }
          l = 0;
          while (l<o.length) {
            var q = 0;
              while (q<o[l].length) {
                 o[l][q] = o[l][q].split(": ");
                q++;
              }
            l++;
          }
        }
      } 
      var getJSON = function(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload = function() {
          var status = xhr.status;
          if (status === 200) {
            callback(null, xhr.response);
          } else {
            callback(status, xhr.response);
          }
        };
      xhr.send();
    };
    if (sessionStorage.username == undefined) {
      window.location.href = "/";
    }
    var d = [], e = [], socket = new WebSocket('wss://connect.websocket.in/v3/1?apiKey=c37MW77TpY8GDiA4yfQPegQUtlFUJkK5d2i1Nrkuk87aCjfwtsxTxHPgKdLn');;
    window.setTimeout(function() {
      window.setInterval(updateChat, 50);
      socket.onmessage = function(e) {
        updateChat(JSON.parse(e.data));
      }
    }, 5000);
    function updateChat(m) {
      get(3,1);
      setTimeout(function(){messages=o[3][0][1];},2000);
      if (m != undefined) {
        messages = JSON.stringify(JSON.parse(messages).concat(JSON.parse(m)));
      }
      var l = 0;
      while (l<e.length) {
        e[l].style.display = "none";
        l++;
      }
      d = [];
      var l = 0;
      while (l<JSON.parse(messages).length) {
        if (JSON.parse(messages)[l].user != undefined) var q = JSON.parse(messages)[l].user.split(":");
        if (JSON.parse(messages)[l].send == sessionStorage.username || JSON.parse(messages)[l].user == sessionStorage.username || JSON.parse(messages)[l].user == "public" || q.indexOf(sessionStorage.username) != -1 || sessionStorage.username == "admin") {
          var t = document.createElement("SPAN");
          if (sessionStorage.username == JSON.parse(messages)[l].send || sessionStorage.username == "admin") {
            var q = document.createElement("BUTTON");
            q.setAttribute("id", l);
            q.setAttribute("onclick", 't=JSON.parse(messages);var index = this.id; if (index>-1) {t.splice(index,1)};update("B5", JSON.stringify(t));')
            q.innerHTML = "CLICK 3x TO DELETE";
            t.innerHTML = q.outerHTML+" "+JSON.parse(messages)[l].send+": <b>"+JSON.parse(messages)[l].message+"</b> to:"+JSON.parse(messages)[l].user+" at: "+JSON.parse(messages)[l].timestamps;
          } else {
            t.innerHTML = JSON.parse(messages)[l].send+": <b>"+JSON.parse(messages)[l].message+"</b> to: "+JSON.parse(messages)[l].user+" at: "+JSON.parse(messages)[l].timestamps;
          } 
          document.getElementById("messages").appendChild(t);
          e.push(t);
          d.push(t);
        } 
        l++;
      }
    }
    document.getElementById("submit").addEventListener("click", send);
    function send() {
      if (document.getElementById("from").value!=""&&document.getElementById("message").value!="") {
        var m = document.getElementById("message").value;
        if (m.replace(/\s/g,'').toLowerCase().includes("damn") || m.replace(/\s/g,'').toLowerCase().includes("shit") || m.replace(/\s/g,'').toLowerCase().includes("fuck") || m.replace(/\s/g,'').toLowerCase().includes("ass") || m.replace(/\s/g,'').toLowerCase().includes("bitch") || m.replace(/\s/g,'').toLowerCase().includes("cunt")) { // CHASE Put in the 'words' in the includes("<here>") area (delete this after you do it)
          alert("Cuss Word Detected! We do not permit any cuss words. If you disagree that you have not cuss words in your message report to 'admin' in chat");
        } else {
         socket.send(JSON.stringify({message:document.getElementById("message").value,user:document.getElementById("from").value,send:sessionStorage.username,timestamps:new Date()}));
         update("B5", JSON.stringify(JSON.parse(messages).concat({message:document.getElementById("message").value,user:document.getElementById("from").value,send:sessionStorage.username,timestamps:new Date()})));
        }
        document.getElementById("message").value = "";
        document.getElementById("from").value = "";
      }
    }
  </script>
</html>
