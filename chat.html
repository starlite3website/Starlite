<html>
  <iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/gameData" width="0" height="0" id="e1"></iframe>
  <iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/username" width="0" height="0" id="e2"></iframe>
  <iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/password" width="0" height="0" id="e3"></iframe>
  <iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/messages" width="0" height="0" id="e4"></iframe>
  <script>
  window.setInterval(reload,15000);
  function reload() {
    document.getElementById("e1").src = document.getElementById("e1").src;
    document.getElementById("e2").src = document.getElementById("e2").src;
    document.getElementById("e3").src = document.getElementById("e3").src;
    document.getElementById("e4").src = document.getElementById("e4").src;
  }
</script>
  <title>Starlite | Chat</title>
  <div id="messages">
  </div>
  <div>
    <textarea placeholder="Message" id="message"></textarea>
    <input type="text" placeholder="To" id="from"/>
    <button id="submit">SUBMIT</button>
  </div>
  <style>
    span {
      display: block;
      font-family: Courier;
    }
    textarea {
      margin-bottom: 10px;
      margin-top: 10px;
      width: 200px;
      height: 100px;
      display: block;
      background-color: white;
      font-family: Courier;
      border: 1px solid black;
      padding: 10px;
    }
    input {
      margin-bottom: 10px;
      width: 200px;
      display: block;
      font-family: Courier;
      background-color: white;
      border: 1px solid back;
      padding: 10px;
    }
    button {
      font-family: Courier;
      color: white;
      background-color: orange;
      border: 1px solid orange;
      padding: 5px;
      border-radius: 20px;
    }
  </style>
  <script src="https://unpkg.com/kvdb.io@1.0.5/index.js" integrity="sha384-91zc4JidmYl6NUcicf1m8ABob6eO1HkULPeHYooqi1sptqZ9k5vaZqSNNkVlPsap" crossorigin="anonymous"></script>
  <script>
    if (sessionStorage.username == undefined) {
      window.location.href = "https://starlite3.tk";
    }
    var d = [], e = [], storeValue = KVdb.bucket('2Rpva475jos9znd2tZZZN9', 12481485).localStorage();
    window.setInterval(update, 50);
    function update() {
      storeValue.getItem("messages").then(value => messages = value);
      var l = 0;
      while (l<e.length) {
        e[l].style.display = "none";
        l++;
      }
      d = [];
      var l = 0;
      while (l<JSON.parse(messages).length) {
        if (JSON.parse(messages)[l].user != undefined) var q = JSON.parse(messages)[l].user.split(":");
        if (JSON.parse(messages)[l].send == sessionStorage.username || JSON.parse(messages)[l].user == sessionStorage.username || JSON.parse(messages)[l].user == "public" || q.indexOf(sessionStorage.username) != -1) {
          var t = document.createElement("SPAN");
          t.innerHTML = JSON.parse(messages)[l].send+": <bold>"+JSON.parse(messages)[l].message+"</bold> to: "+JSON.parse(messages)[l].user+" at: "+JSON.parse(messages)[l].timestamps;
          document.getElementById("messages").appendChild(t);
          e.push(t);
          d.push(t);
        } 
        l++;
      }
    }
    document.getElementById("submit").addEventListener("click", send);
    function send() {
      if (document.getElementById("from").value!=""&&document.getElementById("message").value!="") {
            storeValue.setItem("messages", JSON.stringify(JSON.parse(messages).concat({message:document.getElementById("message").value,user:document.getElementById("from").value,send:sessionStorage.username,timestamps:new Date()})));
            document.getElementById("message").value = "";
            document.getElementById("from").value = "";
      }
    }
  </script>
</html>
