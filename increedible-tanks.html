<!DOCTYPE html>
<html>
  <audio autoplay loop>
  	<source src="https://starlite3.tk/549681549473881.mp3" type="audio/mp3">
  </audio>
  <div id="game" class="container">
    <h1 id="gameName">
      Increedible Tanks
    </h1>
    <h4 id="chatText">
      Chat
    </h4>
    <div id="chat">
      <div id="messages">
      </div>
      <input type="text" id="message" placeholder="Enter a Message" />
      <input type="text" id="to" placeholder="Who to send to?">
      <button id="chat_submit">
			  Send
      </button>
    </div>
    <canvas width="500" height="500" id="canvas" tabindex='1'>
	  	<strong>Canvas is not supported.</strong>
			Try using a diffrent browser,
			If that does not work, please restart your device or use a diffrent device.
   </canvas>

    <div id="play">
      <h5 id="playText">
        Click Anywhere To Start
      </h5>
    </div>

    <div id="alertConsole">
      <h5 id="consoleText">
      </h5>
    </div>

  </div>
  <script>
var interval, user, listener, interval2, b = [],
  s = [], ai = [],
  Game = new Game();
function Ai() {
	this.x = 0;
	this.y = 0;
  this.control = function() {
    window.setInterval(this.draw, 10);
		window.setInterval(this.move, 10);
  }.bind(this);
  this.draw = function() {
    draw.fillStyle="#000000";
    draw.fillRect(this.y,this.x,50,50);

  }.bind(this);
	this.move = function() {
		this.instructions = this.moveCalc();
		if (this.instructions.up == true) {
			this.y -= 10;
		} else if (this.instructions.down == true) {
			this.y += 10;
		} else if (this.instructions.left == true) {
			this.x += 10;
		} else {
			this.x -= 10;
		}
	}.bind(this);
	this.aim = function() {
		return [0,0];
	}.bind(this);
	moveCalc = function() {
		this.xdistance = user.tank.x - this.x;
		this.ydistance = user.tank.y - this.y;
		if (Math.abs(this.ydistance) > Math.abs(this.xdistance)) {
			if (this.ydistance > 0) {
				return { up : true, down : false, left : false, right : false };
			} else {
				return { up : false, down : true, left : false, right : false };
			}
		} else if (Math.abs(this.xdistance) > Math.abs(this.ydistance)) {
			if (this.xdistance > 0) {
			  return { up : false, down : false, left : false, right : true };
		  } else {
				return { up : false, down : false, left : true, right : false };
			}
		} else {
			var min=1; 
                        var max=2;  
                        var q =Math.floor(Math.random() * (+max - +min)) + +min;
			if (q==1) {
				if (this.ydistance > 0) {
					return { up : true, down : false, left : false, right : false };
				} else {
					return { up : false, down : true, left : false, right : false };
				}
			} else {
			 	
	    }  
	  }
	}.bind(this);
}
function Shot() {
  this.sensor = function() {
  }
  this.control = function(x, y, id) {
    this.x = x;
    this.y = y;
    this.id = id;
    this.inactive = false;
    this.draw();
  }
  this.draw = function() {
    this.sensor();
    if (!this.inactive) {
      this.y += 2;
      draw.fillStyle = "#000000";
      draw.fillRect(this.x, this.y, 5, 5);
      this.support();
    }
  }
  this.support = function() {
    support(this.id);
  }
}
function support(id) {
  setTimeout(function() {
    s[id].draw();
  }, 25);
}
function clearShot() {
  level(1, "n", false);
}
function Tank() {
  this.r = 0;
  this.x = 50;
  this.y = 50;
  this.mode = 0;
  this.color = "#00ff00";
  this.draw = function() {
    tank_base_png = new Image();
    tank_base_png.src = "https://starlite3.tk/starlite-tank-base.png";
    draw.drawImage(tank_base_png, this.x, this.y);
    tank_top_png = new Image();
    tank_top_png.src = "https://starlite3.tk/starlite-tank-top.png";
    draw.drawImage(tank_top_png, this.x, this.y);
  }
  this.control = function() {
    canvas.focus();
    this.draw();
    canvas.addEventListener("keydown", function(event) {
	    event.preventDefault();	
	    event.stopImmediatePropagation();
	    user.tank.move(event);
    }, false);
  }
  this.inactive = false;
  this.move = function(e) {
		if (this.inactive == false) {
      if (e.which == 37) {
	      if (checker(this.x - 5, this.y) != false) {
					this.x -= 5;
				}
      }
      if (e.which == 38) {
	      if (checker(this.x,this.y-5) != false) {
					this.y -= 5;
				}
      }
      if (e.which == 39) {
	      if (checker(this.x + 5, this.y) != false) {
					this.x += 5;
				}
      }
      if (e.which == 40) {
       if (checker(this.x, this.y + 5) != false) {
				 this.y += 5;
			 }
      }
      if (e.which == 32) {
	      this.fire();
      }
      level(1, "n", false);
      this.draw();
		} else {
		 a("Game is paused", "yellow");
		}
  }
  this.fire = function() {
    Game.shotId = Game.shotId + 1;
    s[Game.shotId] = new Shot();
    s[Game.shotId].control(this.x + 17, this.y + 45, Game.shotId);
  }
} // Tank Object
function checker(x, y) {
	if (x < 0 || y < 0 || x > 500 || y > 500) {
		return false;
	}
	var l = 0;
	while (l < Game.blockId) {
		l = l + 1;
		if ((x+40>b[l].x*50 && x+40<b[l].x*50+50)||(x>b[l].x*50&&x<b[l].x*50+50)) {
			if ((y>b[l].y*50&&y<b[l].y*50+50)||(y+40>b[l].y*50&&y+40<b[l].y*50+50)) {
			  return false;
			}
		}
	}
}
function Game() {
  this.paused = false;
  this.aiId = 0;
  this.shotId = 0;
  this.blockId = 0;
  this.redraw = function() {
    for (var r = 1; r == this.shotId; r++) {
      s[r].redraw();
    }
  }
  this.control = function() {
    canvas.addEventListener("keyup", function(event) {
      if (event.which == 80) {
        if (this.paused == false) {
	  this.paused = true;
	  user.tank.inactive = true;
	} else {
	  this.paused = false;
	  user.tank.inactive = false;
	}
        alert(this.paused);
      }
    }, false);
  }
  this.i = function() {
    this.interval = window.setInterval(function() {
      clearShot();
    }, 74);
  }
}
function jquery_tank_support(e) {
  user.tank.move(e);
}
function Block(health, x, y, isInvincible, isExplosive) {
  if (!isInvincible) {
    this.health = health;
    this.oh = health;
  } else {
    this.health = Infinity;
  }
  if (isExplosive) {
    this.e = true;
  } else {
    this.e = false;
  }
  this.blockId = Game.blockId;
  this.x = x;
  this.y = y;
} // All Blocks
var alertConsole = document.getElementById("alertConsole"); // console for game
var chat = document.getElementById("chat");
var messages = document.getElementById("messages");
var message = document.getElementById("message");
var playText = document.getElementById("playText");
var canvas = document.getElementById("canvas"); // getting the canvas element
var consoleText = document.getElementById("consoleText"); // text control for console
var chatSubmit = document.getElementById("chat_submit");
var draw = canvas.getContext("2d"); // getting the canvas to be able to draw
function startScreen() {
  chat_setup();
  a("Loading Game...", "black");
  draw.fillStyle = "#DCDCDC";
  draw.fillStyle = "#000000";
  draw.font = "20px Courier";
  wall(0, 3);
  wall(0, 4);
  wall(0, 5);
  wall(0, 6);
  strong(1, 6);
  weak(1, 4);
  wall(2, 4);
  strong(2, 5);
  strong(2, 3);
  draw.fillStyle = "#556B2F";
  draw.fillRect(0, 0, 500, 150);
  draw.fillRect(0, 350, 500, 150);
  draw.fillStyle = "#ffffff";
  draw.font = "50px Courier";
  draw.fillText("Increedible", 100, 60);
  draw.fillText("Tanks", 175, 120);
  canvas.addEventListener("click", loading, false);
} // startScreen
function alert_startup() {
  alertConsole.style.visibility = "hidden";
} // alert Setup
function a(m, c) {
  alertConsole.classList.add("console");
  alertConsole.style.backgroundColor = c;
  alertConsole.style.border = "1px solid black";
  consoleText.innerHTML = m;
  alertConsole.style.visibility = "visible";
  interval = window.setInterval(alert_end, 8000);
} // alert control
function alert_end() {
  window.clearInterval(interval);
  alertConsole.classList.remove("console");
  alertConsole.style.visibility = "hidden";
} // alert end
function loading() {
  if (sessionStorage.user === undefined) {
    user = {
      username: "starlite_developer",
      tank: new Tank(),
      level: 1,
      team: "Increedible: " + "",
      progress : {
        level : 1,
	gems : 0,
	coins : 0,
      }
    }
  }
  draw.clearRect(0, 0, 500, 500);
  a("Starting Game...");
  playText.style.visibility = "hidden";
  setTimeout(mainMenu(), 2000);
  canvas.removeEventListener("click", loading);
}
function level(num, mo, m) {
  draw.clearRect(0, 0, 500, 500);
  draw.fillStyle = "#dcdcdc";
  draw.fillRect(0, 0, 500, 500);
  user.tank.draw();
  if (mo != "n") {
    Game.control();
    Game.i();
    user.tank.control();
  }
  if (num == 1) {
    if (mo != "n") {
      spawn(0, 0);
    }
    weak(2, 0, m);
    weak(3, 0, m);
    strong(5, 0, m);
    createAi( 6*50, 0, m, 3, 3);
    // bomb(7,0, m);
    weak(9, 0, m);
    weak(2, 1, m);
    weak(3, 1, m);
    strong(6, 1, m);
    strong(8, 1, m);
    weak(2, 2, m);
    weak(3, 2, m);
    wall(0, 3, m);
    wall(1, 3, m);
    wall(2, 3, m);
    wall(3, 3, m);
    wall(4, 3, m);
    wall(5, 3, m);
    wall(6, 3, m);
    wall(7, 3, m);
    wall(8, 3, m);
    weak(9, 3, m);
    // chest(200, 1, 4, m);
    wall(3, 4, m); 
    wall(6, 4, m);
    // chest(9,4, m);
  }
  if (num === 2) {
    // level two
  }
}
function keySupport(e) {
  if (e.which == 76) {
    levelSelect(user.progress.level);
  }
}
	  
function mainMenu() {
  window.clearInterval(interval2);
  draw.clearRect(0, 0, 500, 500);
  playText.style.visibility = "hidden";
  draw.fillStyle = "#556B2F";
  draw.fillRect(50, 50, 400, 400);
	draw.fillStyle = "#ffffff";
  draw.fillRect(75, 95, 50, 50);
	draw.font = "15px Courier";
  draw.fillText(user.username, 150, 125);
  draw.fillText("Level:" + user.level, 325, 125);
  draw.fillText("Coins:" + user.coins, 75, 190);
  draw.fillText("Gems:" + user.gems, 75, 210);
	draw.fillText("Type:" + user.type, 75, 230);
  draw.fillText("Team:" + user.team, 75, 250);
  draw.fillText("Settings", 150, 270);
  canvas.addEventListener("keyup", keySupport);
} // main Menu
function levelSelect(l) {
	level(l, null, true);
}
function wall(x, y, m) {
  if (m) {
    Game.blockId++;
    b[Game.blockId] = new Block(0, x, y, true);
  }
  draw.strokeStyle = "#000000";
  draw.fillStyle = "#ADD8E6";
  draw.strokeRect(x * 50, y * 50, 50, 50);
  draw.fillRect(x * 50, y * 50, 50, 50);
  draw.beginPath();
  draw.moveTo(x * 50, y * 50);
  draw.lineTo(x * 50 + 10, y * 50 + 10);
  draw.lineTo(x * 50 + 40, y * 50 + 10);
  draw.lineTo(x * 50 + 50, y * 50 + 0);
  draw.stroke();
  draw.moveTo(x * 50, y * 50);
  draw.lineTo(x * 50 + 10, y * 50 + 10);
  draw.lineTo(x * 50 + 10, y * 50 + 40);
  draw.lineTo(x * 50, y * 50 + 50);
  draw.stroke();
  draw.moveTo(x * 50, y * 50 + 50);
  draw.lineTo(x * 50 + 10, y * 50 + 40);
  draw.lineTo(x * 50 + 40, y * 50 + 40);
  draw.lineTo(x * 50 + 50, y * 50 + 50);
  draw.stroke();
  draw.moveTo(x * 50 + 50, y * 50 + 50);
  draw.lineTo(x * 50 + 40, y * 50 + 40);
  draw.lineTo(x * 50 + 40, y * 50 + 10);
  draw.lineTo(x * 50 + 50, y * 50 + 0);
  draw.stroke();
} // creates a wall
function strong(x, y, m) {
  if (m) {
    Game.blockId++;
    b[Game.blockId] = new Block(20, x, y, false, false);
  }
  draw.strokeStyle = "#000000";
  draw.fillStyle = "#D3D3D3";
  draw.strokeRect(x * 50, y * 50, 50, 50);
  draw.fillRect(x * 50, y * 50, 50, 50);
  draw.beginPath();
  draw.moveTo(x * 50, y * 50);
  draw.lineTo(x * 50 + 10, y * 50 + 10);
  draw.lineTo(x * 50 + 40, y * 50 + 10);
  draw.lineTo(x * 50 + 50, y * 50 + 0);
  draw.stroke();
  draw.moveTo(x * 50, y * 50);
  draw.lineTo(x * 50 + 10, y * 50 + 10);
  draw.lineTo(x * 50 + 10, y * 50 + 40);
  draw.lineTo(x * 50, y * 50 + 50);
  draw.stroke();
  draw.moveTo(x * 50, y * 50 + 50);
  draw.lineTo(x * 50 + 10, y * 50 + 40);
  draw.lineTo(x * 50 + 40, y * 50 + 40);
  draw.lineTo(x * 50 + 50, y * 50 + 50);
  draw.stroke();
  draw.moveTo(x * 50 + 50, y * 50 + 50);
  draw.lineTo(x * 50 + 40, y * 50 + 40);
  draw.lineTo(x * 50 + 40, y * 50 + 10);
  draw.lineTo(x * 50 + 50, y * 50 + 0);
  draw.stroke();
} // creates a strong block
function spawn(x, y) {
  user.tank.x = x;
  user.tank.y = y;
  user.tank.spawn = [x, y];
}
function weak(x, y, m) {
  if (m) {
    Game.blockId++;
    b[Game.blockId] = new Block(10, x, y, false, false);
  }
  draw.strokeStyle = "#000000";
  draw.fillStyle = "#ffffff";
  draw.strokeRect(x * 50, y * 50, 50, 50);
  draw.fillRect(x * 50, y * 50, 50, 50);
  draw.beginPath();
  draw.moveTo(x * 50, y * 50);
  draw.lineTo(x * 50 + 10, y * 50 + 10);
  draw.lineTo(x * 50 + 40, y * 50 + 10);
  draw.lineTo(x * 50 + 50, y * 50 + 0);
  draw.stroke();
  draw.moveTo(x * 50, y * 50);
  draw.lineTo(x * 50 + 10, y * 50 + 10);
  draw.lineTo(x * 50 + 10, y * 50 + 40);
  draw.lineTo(x * 50, y * 50 + 50);
  draw.stroke();
  draw.moveTo(x * 50, y * 50 + 50);
  draw.lineTo(x * 50 + 10, y * 50 + 40);
  draw.lineTo(x * 50 + 40, y * 50 + 40);
  draw.lineTo(x * 50 + 50, y * 50 + 50);
  draw.stroke();
  draw.moveTo(x * 50 + 50, y * 50 + 50);
  draw.lineTo(x * 50 + 40, y * 50 + 40);
  draw.lineTo(x * 50 + 40, y * 50 + 10);
  draw.lineTo(x * 50 + 50, y * 50 + 0);
  draw.stroke();
}
function chat_setup() {
  chatSubmit.addEventListener("click", chat_submit);
}
function chat_submit() {
  if (message.value != "") {
    if (user.username != undefined) {
      var newMessage = document.createElement("SPAN");
      newMessage.innerHTML = user.username + ": " + message.value + " to: " + to.value;
      sessionStorage.setItem("messages", [user.username, message.value, to.value].concat(sessionStorage.getItem("messages")));
      messages.appendChild(newMessage);
      newMessage.classList.add("message");
      a("Message Sent", "green");
    } else {
      a("Start Game First", "red");
    }
  } else {
    a("Enter Text to Submit", "red");
  }
}
function createAi(x, y, m, t, team) {
  if (m) {
    Game.aiId++;
    ai[Game.aiId] = new Ai();
    ai[Game.aiId].id = Game.aiId;
    ai[Game.aiId].x = x;
    ai[Game.aiId].y = y;
    ai[Game.aiId].master = team;
    ai[Game.aiId].type = t;
		ai[Game.aiId].control();
  }
}
startScreen();
  </script>
  <style>
  canvas {
  outline: hidden;
  border: 1px solid black;
  z-index: 1;
}
#messages {
  width: 100%;
  height: 100px;
  overflow: auto;
}
#message {
  margin-left: 30px;
}
#chat_submit {
  background-color: #000000;
  color: white;
  border: 1px #000000;
}
h4 {
  color: white;
  margin-bottom: -25px;
  margin-left: 15px;
}
.message {
  border: 1px solid black;
  background-color: white;
  color: black;
  display: block;
  font-family: Courier;
}
#chat {
  padding: 20px;
  border-top: 30px solid blue;
  border-bottom: 5px solid blue;
  border-left: 5px solid blue;
  border-right: 5px solid blue;
  border-radius: 10px;
  margin-bottom: 5px;
  margin-left: 5px;
}
.console {
  animation: alert 8s;
}
#play {
  margin-top: -290px;
  margin-left: 120px;
}
#playText {
  animation: blink 4s infinite;
  font-size: 20px;
  font-family: Courier;
  z-index: 2;
  position: relative;
}
@keyframes blink {
  0% {
    color: #000;
  }
  49% {
    color: transparent;
  }
  50% {
    color: #000;
  }
  99% {
    color: transparent;
  }
  100% {
    color: #000;
  }
}
#consoleText {
  color: white;
}
#alertConsole {
  z-index: 1000;
  margin-top: 220px;
  padding: 20px;
  border-radius: 20px;
  position: relative;
}
h1 {
  font-family: Courier;
}
@keyframes alert {
  0% {
    margin-top: 220px;
  }
  20% {
    margin-top: 120px;
  }
  90% {
    margin-top: 120px;
  }
  100% {
    margin-top: 220px;
  }
}
  </style>
</html>
