<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132422058-1"></script>
<iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/gameData" width="0" height="0" id="e1"></iframe>
<iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/username" width="0" height="0" id="e2"></iframe>
<iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/password" width="0" height="0" id="e3"></iframe>
<iframe src="https://kvdb.io/2Rpva475jos9znd2tZZZN9/messages" width="0" height="0" id="e4"></iframe>
<script src="https://unpkg.com/kvdb.io@1.0.5/index.js" integrity="sha384-91zc4JidmYl6NUcicf1m8ABob6eO1HkULPeHYooqi1sptqZ9k5vaZqSNNkVlPsap" crossorigin="anonymous"></script>
<script>
  window.setInterval(reload, 15000);
  var storeValue = KVdb.bucket('2Rpva475jos9znd2tZZZN9', 12481485).localStorage();
  var c, s=[], d=[];
  storeValue.getItem("counter").then(value => c = value);
  storeValue.getItem("gameData").then(value => w = value);
  setTimeout(r, 5000);
  function r() {
    storeValue.setItem("counter", JFSON.parse(c)+1);
    document.getElementById("views").innerHTML = 'Views: <b>'+JSON.stringify(JSON.parse(c)+1)+'</b>';
    document.getElementById("users").innerHTML = 'Users: <b>'+JSON.stringify(JSON.parse(w).length)+'</b>';
  }
  function reload() {
    document.getElementById("e1").src = document.getElementById("e1").src;
    document.getElementById("e2").src = document.getElementById("e2").src;
    document.getElementById("e3").src = document.getElementById("e3").src;
    document.getElementById("e4").src = document.getElementById("e4").src;
  }
</script>
  <title>Starlite | Increedible Tanks</title>
</head>
<div id="game" class="container">
  <h1 id="gameName"> Increedible Tanks </h1>
  <h3 id="views"></h3>
  <h3 id="users"></h3>
  <h2>Increedible Tanks Multiplayer is Coming Soon!</h2>
  <canvas width="500" height="500" id="canvas" tabindex='1'>
    <strong>Canvas is not supported.</strong> Try using a diffrent browser, If that does not work, please restart your device or use a diffrent device. </canvas>
  <iframe src="/chat" width="500" height="500"></iframe>
  <div id="play">
    <h5 id="playText"> Click Anywhere To Start </h5>
  </div>
  <div id="alertConsole">
    <h5 id="consoleText">
    </h5>
  </div>
  <a href="http://onvictinitor.com/afu.php?zoneid=3033122"><b>Support Starlite(ad)</b></a>
</div>
<script>
  var interval, user, listener, interval2, b = [],
    s = [],
    ai = [],
    l1 = 0,
    l2 = 0,
    i = [],
    Game = new Game();
  var storeValue = KVdb.bucket('2Rpva475jos9znd2tZZZN9', 12481485).localStorage();
  function ai_check(x, y) {
    var l = 1;
    while (l < Game.shotId) {
      l = l + 1;
      if (s[l].x > x || s[l].x + 10 > x) {
        if (s[l].x < x + 40 || s[l].x + 10 < x + 40) {
          if (s[l].y > y || s[l].y + 10 > y) {
            if (s[l].y < y + 40 || s[l].y + 10 < y + 40) {
              s[l].inactive = true;
              return true;
            }
          }
        }
      }
    }
    return false;
  }
  function Ai() {
    this.health = 200;
    this.x = 0;
    this.y = 0;
    this.control = function() {
      i.push(window.setInterval(this.draw, 1));
      i.push(window.setInterval(this.move, 500));
      i.push(window.setInterval(this.check, 10));
    }.bind(this);
    this.draw = function() {
      if (this.inactive != true) {
        ai_top = new Image();
        ai_top.src = "/starlite-tank-top.png";
        ai_base = new Image();
        ai_base.src = "/starlite-tank-base.png";
        draw.drawImage(ai_base, this.x, this.y);
        draw.translate(this.x + 20, this.y + 20);
        draw.rotate(this.rotation * Math.PI / 180);
        draw.drawImage(ai_top, -20, -20);
        draw.rotate(-(this.rotation * Math.PI / 180));
        draw.translate(-this.x - 20, -this.y - 20);
      }
    }.bind(this);
    this.move = function() {
      if (this.inactive != true) {
        this.instructions = this.moveCalc();
        if (this.instructions.fire == true) {
          this.fire();
        } else if (this.instructions.up == true) {
          if (checker(this.x - 5, this.y) != false) {
            this.x -= 10;
          }
        } else if (this.instructions.down == true) {
          if (checker(this.x, this.y - 5) != false) {
            this.x += 10;
          }
        } else if (this.instructions.left == true) {
          if (checker(this.x + 5, this.y) != false) {
            this.y -= 10;
          }
        } else {
          if (checker(this.x, this.y + 5) != false) {
            this.y += 10;
          }
        }
      } else {
        window.clearInterval(this.aiDraw);
      }
    }.bind(this);
    this.fire = function() {
      this.xd = 1;
      this.angle = this.rotation % 90;
      if (this.rotation < 90 || (this.rotation < 270 && this.rotation > 180)) {
        this.yd = Math.abs(((this.xd * this.angle+90) - (90 * this.xd)) / this.angle+90);
        this.yd = Math.abs(this.yd);
      } else {
        this.yd = Math.abs(((this.xd * this.angle) - (90 * this.xd)) / this.angle);
        this.yd = 0 - Math.abs(this.yd);
      }
      if (this.rotation > 180) {
        this.xd = Math.abs(this.xd);
      } else {
        this.xd = 0 - Math.abs(this.xd);
      }
      if (this.rotation == 0) {
        this.xd = 0;
        this.yd = 1;
      } else if (this.rotation == 90) {
        this.xd = -1;
        this.yd = 0;
      } else if (this.rotation == 180) {
        this.xd = 0;
        this.yd = -1;
      } else if (this.rotation == 270) {
        this.xd = 1;
        this.yd = 0;
      }
      Game.shotId = Game.shotId + 1;
      s[Game.shotId] = new Shot();
      if (this.x < user.tank.x) {
        s[Game.shotId].control(this.x + 20, this.y + 20, Game.shotId, Math.abs(this.xd), this.yd);
      } else {
        s[Game.shotId].control(this.x + 20, this.y + 20, Game.shotId, this.xd, this.yd);
      }
    }
    this.check = function() {
      if (ai_check(this.x, this.y)) {
        if (this.inactive != true) {
          this.health -= 20;
          if (this.health <= 0) {
            Game.coins += 100;
            Game.foes--;
            this.x = undefined;
            this.y = undefined;
            this.inactive = true;
            if (Game.foes == 0) {
              setTimeout(victory, 20);
              Game.endGame();
            }
          }
        }
      }
    }.bind(this);
    this.rotation = 0;
    this.moveCalc = function() {
      this.xdistance = user.tank.x - this.x;
      this.ydistance = user.tank.y - this.y;
      this.rotation = Math.atan(this.ydistance / this.xdistance) * 180 / Math.PI;
      if (this.xdistance > 0) {
        this.rotation -= 90;
      } else {
        this.rotation += 90;
      }
      if (300 > Math.sqrt(this.xdistance * this.xdistance + this.ydistance * this.ydistance)) {
        return { fire: true };
      } else {
        if (Math.abs(this.ydistance) > Math.abs(this.xdistance)) {
          if (this.ydistance > 0) {
            return { up: false, down: false, left: false, right: true };
          } else {
            return { up: false, down: false, left: true, right: false };
          }
        } else if (Math.abs(this.xdistance) > Math.abs(this.ydistance)) {
          if (this.xdistance > 0) {
            return { up: false, down: true, left: false, right: false };
          } else {
            return { up: true, down: false, left: false, right: false };
          }
        } else {
          if (this.ydistance < 0) {
            return { left: true };
          } else {
            return { right: true };
          }
        }
      }
    }.bind(this);
  }
  function Shot() {
    this.sensor = function() {}
    this.control = function(x, y, id, xm, ym) {
      this.x = x + xm * 16;
      this.y = y + ym * 16;  
      this.ym = ym * 16;
      this.xm = xm * 16;
      while (Math.abs(this.ym) > 20) {
        this.xm /= 2;
        this.ym /= 2;
      }
      this.id = id;
      this.inactive = false;
      this.draw();
    }
    this.draw = function() {
      this.sensor();
      if (!this.inactive) {
        this.y += this.ym;
        this.x += this.xm;
        draw.fillStyle = "#000000";
        draw.fillRect(this.x, this.y, 5, 5);
        this.support();
      } else {
        this.x = undefined;
        this.y = undefined;
      }
    }
    this.support = function() {
      support(this.id);
    }
  }
  function support(id) {
    setTimeout(function() {
      if (s[id]!=undefined) {
        s[id].draw();
      }
    }, 25);
  }
  function clearShot() {
    if (user.tank != undefined) {
      level(Game.level, "n", false);
    }
    var l = 0;
    while (l < ai.length - 1) {
      l++;
      ai[l].draw();
    }
  }
  function Host() {
    this.control = function(id) {
      document.removeEventListener("keydown", multiplayer1);
      document.removeEventListener("click", multiplayer2);
      this.socket = new WebSocket("wss://connect.websocket.in/v2/"+id+"?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImY1ZTIxMDM4ZDQzMjFmNWQ3YzQ1NzhiYTFhZGU4NDZhMGE0ODY2MGQxODg1YzJlZjMwZTc1NjBiNzQ0Y2EwYjZlYzc3NmE1Y2Q4MDE3ZTc4In0.eyJhdWQiOiI4IiwianRpIjoiZjVlMjEwMzhkNDMyMWY1ZDdjNDU3OGJhMWFkZTg0NmEwYTQ4NjYwZDE4ODVjMmVmMzBlNzU2MGI3NDRjYTBiNmVjNzc2YTVjZDgwMTdlNzgiLCJpYXQiOjE1NzkyMDAxNDksIm5iZiI6MTU3OTIwMDE0OSwiZXhwIjoxNjEwODIyNTQ5LCJzdWIiOiIzNTMiLCJzY29wZXMiOltdfQ.rBE0cUiXX4J6lD7Ybfa6W-uwXixsroXS8cJh-8IXFVAqK_JPJn3OIexWkwLGIVHDyxiHepXnE8iWTpfoSlDbevHGHyN4SzHcfBSsDFqrHxOibIHJMqWWuAUELZ8C8WCS50EDwnOZQVUac6G5GTkdt4OLdsbUy3akuasC2jIMtYdl00Q_u55Bw9GdLElEGJ3p7uRitxOiEe1SUDntLol4LxkQWr7pS4IqBiIwbhMahNun754Ix_3gqwkTn-B-Gm1laWe02H8RZfKoOD7-JcQHHNVjYdRtlAv1EGs3WcOdr8yus9oo24o3hDe06K3QvEEIkTVuULza-1JnwguBCIxlGd10WKIC0Zg9ikwGHBuv-8q9I3QEbapL54hv9GkSkj6-a0_xOarr1flaUF4gEiocrrjrFnKH24aO8bgFzbxtn7d9hHO7LEFmxYuomf-tlesDvXxxiVnCA_FOA9maT7oW6Fq2dxk9QUxPyZnE0nvamWZBcYYYlXbUSHw9dsW_yZWdirnO1J9O7h0288jVRyw8jGRKCRJC3SPsZIy2943vxdo5yYC089Bx_FlDxgaCfuwTASDYmFd14CZj1suV7qO1pZAbd3JQJUM7R3Ebpcx-IIDvzQmCrPNGOXo8T8L6dt_fY8iY84WaEg56Hs8L3ySbhnFY8Vvea4W648-VmX05KXE");
      this.socket.onopen = function() {
        a('Mutiplayer Server(room: '+id+') created Sucessfully');
        //storeValue.setItem("servers", JSON.stringify(JSON.parse(sessionStorage.servers).concat([id])));
      }
      this.socket.onmessage = function(e) {
        let d = e.data;
        if (d.includes("user ")) {
          let y = d.split("user ");
          this.users.push(JSON.parse(y[1]));
          a(JSON.parse(y[1]).id+" has joined the game");
        }
        if (d.includes("update ")) {
            let y = d.split("update ");
            // recieve user x, y, shots and health??
        }
      }
      this.users.push(user.tank);
      this.gameControl();
    }
    this.gameControl = function() {
      this.generateLevel();
      window.setInterval(this.draw, 100);
    }
    this.draw = function() {
      let p = 0;
      while (p<this.level.weak.length) {
        this.level.weak[p].weak(this.level.weak[p].x, this.level.weak[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.strong.length) {
        this.level.strong[p].strong(this.level.strong[p].x, this.level.strong[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.wall.length) {
        this.level.wall[p].wall(this.level.wall[p].x, this.level.wall[p].y);
        p++;
      }
      this.sendLevel();
    }.bind(this);
    this.users = [];
    this.generateLevel = function() {
      this.level = {weak:[],strong:[],wall:[],shots:[],users:this.users}
      let p = 0;
      while (p<10) {
        let s = new Block(30, Math.floor(Math.random(9)*10), Math.floor(Math.random(9)*10));
        b.push(s);
        this.level.weak.push(s);
        s.weak();
        p++;
      }
      p = 0;
      while (p<10) {
        let s = new Block(30, Math.floor(Math.random(9)*10), Math.floor(Math.random(9)*10));
        b.push(s);
        this.level.strong.push(s);
        s.strong();
        p++;
      }
      p=0;
      while (p<10) {
        let s = new Block(30, Math.floor(Math.random(9)*10), Math.floor(Math.random(9)*10));
        b.push(s);
        this.level.wall.push(s);
        s.wall();
        p++;
      }
    }
    this.sendLevel = function() {
      this.socket.send("level "+JSON.stringify(this.level));
    }.bind(this);
  }
  function Get() {
    this.control = function(id) {
      alert(id);
      this.socket = new WebSocket("wss://connect.websocket.in/v2/"+id+"?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImY1ZTIxMDM4ZDQzMjFmNWQ3YzQ1NzhiYTFhZGU4NDZhMGE0ODY2MGQxODg1YzJlZjMwZTc1NjBiNzQ0Y2EwYjZlYzc3NmE1Y2Q4MDE3ZTc4In0.eyJhdWQiOiI4IiwianRpIjoiZjVlMjEwMzhkNDMyMWY1ZDdjNDU3OGJhMWFkZTg0NmEwYTQ4NjYwZDE4ODVjMmVmMzBlNzU2MGI3NDRjYTBiNmVjNzc2YTVjZDgwMTdlNzgiLCJpYXQiOjE1NzkyMDAxNDksIm5iZiI6MTU3OTIwMDE0OSwiZXhwIjoxNjEwODIyNTQ5LCJzdWIiOiIzNTMiLCJzY29wZXMiOltdfQ.rBE0cUiXX4J6lD7Ybfa6W-uwXixsroXS8cJh-8IXFVAqK_JPJn3OIexWkwLGIVHDyxiHepXnE8iWTpfoSlDbevHGHyN4SzHcfBSsDFqrHxOibIHJMqWWuAUELZ8C8WCS50EDwnOZQVUac6G5GTkdt4OLdsbUy3akuasC2jIMtYdl00Q_u55Bw9GdLElEGJ3p7uRitxOiEe1SUDntLol4LxkQWr7pS4IqBiIwbhMahNun754Ix_3gqwkTn-B-Gm1laWe02H8RZfKoOD7-JcQHHNVjYdRtlAv1EGs3WcOdr8yus9oo24o3hDe06K3QvEEIkTVuULza-1JnwguBCIxlGd10WKIC0Zg9ikwGHBuv-8q9I3QEbapL54hv9GkSkj6-a0_xOarr1flaUF4gEiocrrjrFnKH24aO8bgFzbxtn7d9hHO7LEFmxYuomf-tlesDvXxxiVnCA_FOA9maT7oW6Fq2dxk9QUxPyZnE0nvamWZBcYYYlXbUSHw9dsW_yZWdirnO1J9O7h0288jVRyw8jGRKCRJC3SPsZIy2943vxdo5yYC089Bx_FlDxgaCfuwTASDYmFd14CZj1suV7qO1pZAbd3JQJUM7R3Ebpcx-IIDvzQmCrPNGOXo8T8L6dt_fY8iY84WaEg56Hs8L3ySbhnFY8Vvea4W648-VmX05KXE");
      this.socket.onopen = function() {
        a("Successful Joined Room!");
        user.tank.id = sessionStorage.username;
        this.socket.send("user "+user.tank);
      }.bind(this);
      this.socket.onmessage = function(e) {
        let d = e.data;
        if (d.includes("level ")) {
          let y = d.split('level ');
          user.get.level = JSON.parse(y[1]);
          let p = 0;
          let o = new Block();
          while (p<user.get.level.weak.length) {
            user.get.level.weak[p].weak = o.weak;
            p++;
          }
          p = 0;
          while (p<user.get.level.strong.length) {
            user.get.level.strong[p].strong = o.strong;
            p++;
          }
          p = 0;
          while (p<user.get.level.wall.length) {
            user.get.level.wall[p].wall = o.wall;
            p++;
          }
          user.get.draw();
        }
      }
    }.bind(this);
    this.draw = function() {
      let p = 0;
      while (p<this.level.weak.length) {
        this.level.weak[p].weak(this.level.weak[p].x, this.level.weak[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.strong.length) {
        this.level.strong[p].strong(this.level.strong[p].x, this.level.strong[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.wall.length) {
        this.level.wall[p].wall(this.level.wall[p].x, this.level.wall[p].y);
        p++;
      }
      this.sendLevel();
    }.bind(this);
  }
  function Tank() {
    this.count = 0;
    this.health = userData.health;
    this.r = 0;
    this.x = 0;
    this.y = 0;
    this.mode = 0;
    this.color = "#00ff00";
    this.draw = function() {
      tank_base_png = new Image();
      tank_base_png.src = "/starlite-tank-base.png";
      if (this.leftright == true) {
        draw.translate(this.x + 20, this.y + 20)
        draw.rotate(90 * Math.PI / 180);
        draw.drawImage(tank_base_png, -20, -20);
        draw.rotate(-90 * Math.PI / 180);
        draw.translate((-this.x - 20), (-this.y - 20));
      } else {
        draw.drawImage(tank_base_png, this.x, this.y);
      }
      tank_top_png = new Image();
      tank_top_png.src = "/starlite-tank-top.png";
      draw.translate(this.x + 20, this.y + 20);
      draw.rotate(this.rotation * Math.PI / 180);
      draw.drawImage(tank_top_png, -20, -20);
      draw.rotate(-(this.rotation * Math.PI / 180));
      draw.translate(-this.x - 20, -this.y - 20);
    }
    this.check = function() {
      console.clear()
      if (ai_check(this.x, this.y)) {
        this.health -= 20;
        if (this.health <= 0) {
          this.inactive = true;
          window.clearInterval(this.checkloop);
          window.clearInterval(this.interval);
          window.clearInterval(this.interval2)
          this.checkloop = undefined;
          this.interval = undefined;
          this.interval2 = undefined;
          setTimeout(defeat, 20);
          Game.endGame();
        }
      }
    }
    this.control = function() {
      canvas.focus();
      this.draw();
      i.push(window.setInterval(function() {
        user.tank.check();
      }, 50));
      canvas.addEventListener("keydown", tank_listener1, false);
      canvas.addEventListener("keyup", tank_listener2, false);
    }
    this.inactive = false;
    this.rotation = 0;
    this.move = function(e) {
      e.preventDefault();
      e.stopImmediatePropagation();
      if (this.inactive == false) {
        if (e.code == "KeyD") {
          if (checker(this.x + 5, this.y) != false) {
            this.x += 5;
            this.leftright = true;
            // CHASE put in tank_track.play(); here
          }
        }
        if (e.code == "KeyW") {
          if (checker(this.x, this.y - 5) != false) {
            this.y -= 5;
            this.leftright = false;
            // CHASE put in tank_track.play(); here
          }
        }
        if (e.code == "KeyA") {
          if (checker(this.x - 5, this.y) != false) {
            this.x -= 5;
            this.leftright = true;
            // CHASE put in tank_track.play(); here
          }
        }
        if (e.code == "KeyS") {
          if (checker(this.x, this.y + 5) != false) {
            this.y += 5;
            this.leftright = false;
            // CHASE put in tank_track.play(); here
          }
        }
        if (e.which == 70) {
          if (this.count == 5) {
            this.fire();
            // CHASE put in tank_fire.play(); here
            this.count = 0;
          } else {
            this.count++;
          }
        }
        if (e.which == 37) {
          if (this.rotation == 355) {
            this.rotation = 0;
          } else {
            this.rotation += 5;
          }
        } else if (e.which == 39) {
          if (this.rotation == 0) {
            this.rotation = 355;
          } else {
            this.rotation -= 5;
          }
        }
        level(Game.level, "n", false);
        var l = 0;
        while (l < ai.length - 1) {
          l++;
          ai[l].draw();
        }
        this.draw();
      } else {
        a("Game is paused", "yellow");
      }
    }
    this.fire = function() {
      this.xd = 1;
      this.angle = this.rotation % 90;
      this.yd = Math.abs(((this.xd * this.angle) - (90 * this.xd)) / this.angle);
      if (this.rotation < 90 || this.rotation > 270) {
        this.yd = Math.abs(this.yd);
      } else {
        this.yd = 0 - Math.abs(this.yd);
      }
      if (this.rotation > 180) {
        this.xd = Math.abs(this.xd);
      } else {
        this.xd = 0 - Math.abs(this.xd);
      }
      if (this.rotation == 0) {
        this.xd = 0;
        this.yd = 1;
      } else if (this.rotation == 90) {
        this.xd = -1;
        this.yd = 0;
      } else if (this.rotation == 180) {
        this.xd = 0;
        this.yd = -1;
      } else if (this.rotation == 270) {
        this.xd = 1;
        this.yd = 0;
      }
      Game.shotId = Game.shotId + 1;
      s[Game.shotId] = new Shot();
      if ((this.xd < 0 && this.yd < 0) || (this.xd > 0 && this.yd > 0)) {
        s[Game.shotId].control(this.x + 20, this.y + 20, Game.shotId, this.yd, this.xd);
      } else {
        s[Game.shotId].control(this.x + 20, this.y + 20, Game.shotId, this.xd, this.yd);
      }
    }
  }
  function tank_listener1(event) {
    if (user.tank.interval == undefined) {
      if (event.keyCode == 87 || event.keyCode == 83 || event.keyCode == 68 || event.keyCode == 65) {
        tank_tracks.play();
      }
      user.tank.interval = window.setInterval(function() {
        user.tank.move(event);
      }, 20);
    }
  }
function tank_listener2(event) {
  window.clearInterval(user.tank.interval);
  tank_tracks.pause();
  tank_tracks.load();
  user.tank.interval = undefined;
}
  function checker(x, y) {
    if (x < 0 || y < 0 || x + 40 > 500 || y + 40 > 500) {
      return false;
    }
    var l = 0;
    while (l < Game.blockId) {
      l = l + 1;
      if ((x + 40 > b[l].x * 50 && x + 40 < b[l].x * 50 + 50) || (x > b[l].x * 50 && x < b[l].x * 50 + 50)) {
        if ((y > b[l].y * 50 && y < b[l].y * 50 + 50) || (y + 40 > b[l].y * 50 && y + 40 < b[l].y * 50 + 50)) {
          return false;
        }
      }
    }
  }
  document.addEventListener("keydown", function(event) {
    if (event.keyCode == 89) {
      console.log(ai, Game.foes)
    }
  });
  function gameHelper() {
    var l = 0;
    while (l < i.length) {
      window.clearInterval(i[l]);
      l++;
    }
    b = [];
    ai = [];
    s = [];
    user.tank = undefined;
    Game.blockId = 0;
    Game.shotId = 0;
    Game.aiId = 0;
    mainMenu();
  }
  function Game() {
    this.coins = 0;
    this.foes = 0;
    this.paused = false;
    this.aiId = 0;
    this.shotId = 0;
    this.blockId = 0;
    this.endGame = function() {
      document.removeEventListener("click", levelSelectSupport);
      window.clearInterval(user.tank.interval);
      canvas.removeEventListener("keydown", tank_listener1);
      canvas.removeEventListener("keyup", tank_listener2);
      gameHelper();
    }
    this.redraw = function() {
      for (var r = 1; r == this.shotId; r++) {
        s[r].redraw();
      }
    }
    this.control = function() {
      canvas.addEventListener("keyup", function(event) {
        if (event.which == 80) {
          if (this.paused == false) {
            this.paused = true;
            user.tank.inactive = true;
          } else {
            this.paused = false;
            user.tank.inactive = false;
          }
          alert(this.paused);
        }
      }, false);
    }
    this.i = function() {
      i.push(window.setInterval(function() {
        clearShot();
      }, 74));
    }
  } 
  function jquery_tank_support(e) {
    user.tank.move(e);
  }
  function Block(health, x, y, isInvincible, isExplosive) {
    this.blockId = blockHelper();
    this.x = x;
    this.y = y;
    this.wall = function(x,y) {
      var wall_image = new Image();
      wall_image.src = "/block-blue.png"
      draw.drawImage(wall_image, x * 50, y * 50);
      if (this.health == undefined) {
        this.health = Infinity;
      }
    }
    this.strong = function(x,y) {
      if (this.health == undefined) {
        this.health = 30;
      }
      draw.strokeStyle = "#000000";
    draw.fillStyle = "#D3D3D3";
    draw.strokeRect(x * 50, y * 50, 50, 50);
    draw.fillRect(x * 50, y * 50, 50, 50);
    draw.beginPath();
    draw.moveTo(x * 50, y * 50);
    draw.lineTo(x * 50 + 10, y * 50 + 10);
    draw.lineTo(x * 50 + 40, y * 50 + 10);
    draw.lineTo(x * 50 + 50, y * 50 + 0);
    draw.stroke();
    draw.moveTo(x * 50, y * 50);
    draw.lineTo(x * 50 + 10, y * 50 + 10);
    draw.lineTo(x * 50 + 10, y * 50 + 40);
    draw.lineTo(x * 50, y * 50 + 50);
    draw.stroke();
    draw.moveTo(x * 50, y * 50 + 50);
    draw.lineTo(x * 50 + 10, y * 50 + 40);
    draw.lineTo(x * 50 + 40, y * 50 + 40);
    draw.lineTo(x * 50 + 50, y * 50 + 50);
    draw.stroke();
    draw.moveTo(x * 50 + 50, y * 50 + 50);
    draw.lineTo(x * 50 + 40, y * 50 + 40);
    draw.lineTo(x * 50 + 40, y * 50 + 10);
    draw.lineTo(x * 50 + 50, y * 50 + 0);
    draw.stroke();
    }
    this.weak = function(x,y) {
      if (this.health == undefined) {
        this.health = 10;
      }
      var weak_image = new Image();
      weak_image.src = "/block-silver.png";
      draw.drawImage(weak_image, x * 50, y * 50);
    }
    i.push(window.setInterval(function(id) {
      if (ai_check(b[id].x * 50, b[id].y * 50)) {
        b[id].health -= 10;
        if (b[id].health <= 0) {
          block_support(id);
        }
      }
    }, 50, [this.blockId]));
  }
  function blockHelper() {
    return Game.blockId;
  }
  function block_support(id) {
    b[id].x = undefined;
    b[id].y = undefined;
  }
  var alertConsole = document.getElementById("alertConsole"); // console for game
  var messages = document.getElementById("messages");
  var message = document.getElementById("message");
  var playText = document.getElementById("playText");
  var canvas = document.getElementById("canvas"); // getting the canvas element
  var consoleText = document.getElementById("consoleText"); // text control for console
  var draw = canvas.getContext("2d"); // getting the canvas to be able to draw
  var tank_tracks = new Audio("/tank-tracks.mp3");
  tank_tracks.load();
  tank_tracks.volume = 0.4;
  function startScreen() {
    a("Loading Game...", "black");
    draw.fillStyle = "#DCDCDC";
    draw.fillStyle = "#000000";
    draw.font = "20px Courier";
    wall(0, 3);
    wall(0, 4);
    wall(0, 5);
    wall(0, 6);
    strong(1, 6);
    weak(1, 4);
    wall(2, 4);
    strong(2, 5);
    strong(2, 3);
    draw.fillStyle = "#556B2F";
    draw.fillRect(0, 0, 500, 150);
    draw.fillRect(0, 350, 500, 150);
    draw.fillStyle = "#ffffff";
    draw.font = "50px Courier";
    draw.fillText("Increedible", 100, 60);
    draw.fillText("Tanks", 175, 120);
    canvas.addEventListener("click", loading, false);
  } // startScreen
  function alert_startup() {
    alertConsole.style.visibility = "hidden";
  } // alert Setup
  function a(m, c) {
    alertConsole.classList.add("console");
    alertConsole.style.backgroundColor = c;
    alertConsole.style.opacity = .7;
    alertConsole.style.border = "1px solid black";
    consoleText.innerHTML = m;
    alertConsole.style.visibility = "visible";
    i.push(window.setInterval(alert_end, 8000));
  } // alert control
  function alert_end() {
    window.clearInterval(interval);
    alertConsole.classList.remove("console");
    alertConsole.style.visibility = "hidden";
  } // alert end
  var gameData, userData;
  storeValue.getItem("gameData").then(value => gameData = value);
  function loading() {
    if (sessionStorage.username == undefined) {
      alert("SIGN IN TO PLAY: RIDIRECTING");
        window.location.href = "/account";
    }
    var l = 0;
    while (l<JSON.parse(gameData).length) {
      if (JSON.parse(gameData)[l].username==sessionStorage.username) {
        userData = JSON.parse(gameData)[l];
      }
      l++;
    }
    if (userData == undefined) {
      storeValue.setItem("gameData", JSON.stringify(JSON.parse(gameData).concat({username:sessionStorage.username,coins:0,health:200,level:1})));
      userData = {username:sessionStorage.username,coins:0,health:200,level:1};
    }
    if (sessionStorage.level == undefined) {   
      user = {
        tank: new Tank(),
        username: sessionStorage.username,
        level: userData.level,
        coins: userData.coins,
      }
    }
    user.tank.health = userData.health;
    draw.clearRect(0, 0, 500, 500);
    a("Loading...");
    playText.style.visibility = "hidden";
    setTimeout(mainMenu(), 5000);
    canvas.removeEventListener("click", loading);
  }
  function level(num, mo, m) {
    draw.clearRect(0, 0, 500, 500);
    draw.fillStyle = "#dcdcdc";
    var floor = new Image();
    floor.src = "/floor.png";
    draw.drawImage(floor, 0, 0);
    draw.drawImage(floor, 50, 0);
    draw.drawImage(floor, 100, 0);
    draw.drawImage(floor, 150, 0);
    draw.drawImage(floor, 200, 0);
    draw.drawImage(floor, 250, 0);
    draw.drawImage(floor, 300, 0);
    draw.drawImage(floor, 350, 0);
    draw.drawImage(floor, 400, 0);
    draw.drawImage(floor, 450, 0);
    draw.drawImage(floor, 0, 50);
    draw.drawImage(floor, 50, 50);
    draw.drawImage(floor, 100, 50);
    draw.drawImage(floor, 150, 50);
    draw.drawImage(floor, 200, 50);
    draw.drawImage(floor, 250, 50);
    draw.drawImage(floor, 300, 50);
    draw.drawImage(floor, 350, 50);
    draw.drawImage(floor, 400, 50);
    draw.drawImage(floor, 450, 50);
    draw.drawImage(floor, 0, 100);
    draw.drawImage(floor, 50, 100);
    draw.drawImage(floor, 100, 100);
    draw.drawImage(floor, 150, 100);
    draw.drawImage(floor, 200, 100);
    draw.drawImage(floor, 250, 100);
    draw.drawImage(floor, 300, 100);
    draw.drawImage(floor, 350, 100);
    draw.drawImage(floor, 400, 100);
    draw.drawImage(floor, 450, 100);
    draw.drawImage(floor, 0, 150);
    draw.drawImage(floor, 50, 150);
    draw.drawImage(floor, 100, 150);
    draw.drawImage(floor, 150, 150);
    draw.drawImage(floor, 200, 150);
    draw.drawImage(floor, 250, 150);
    draw.drawImage(floor, 300, 150);
    draw.drawImage(floor, 350, 150);
    draw.drawImage(floor, 400, 150);
    draw.drawImage(floor, 450, 150);
    draw.drawImage(floor, 0, 200);
    draw.drawImage(floor, 50, 200);
    draw.drawImage(floor, 100, 200);
    draw.drawImage(floor, 150, 200);
    draw.drawImage(floor, 200, 200);
    draw.drawImage(floor, 250, 200);
    draw.drawImage(floor, 300, 200);
    draw.drawImage(floor, 350, 200);
    draw.drawImage(floor, 400, 200);
    draw.drawImage(floor, 450, 200);
    draw.drawImage(floor, 0, 250);
    draw.drawImage(floor, 50, 250);
    draw.drawImage(floor, 100, 250);
    draw.drawImage(floor, 150, 250);
    draw.drawImage(floor, 200, 250);
    draw.drawImage(floor, 250, 250);
    draw.drawImage(floor, 300, 250);
    draw.drawImage(floor, 350, 250);
    draw.drawImage(floor, 400, 250);
    draw.drawImage(floor, 450, 250);
    draw.drawImage(floor, 0, 300);
    draw.drawImage(floor, 50, 300);
    draw.drawImage(floor, 100, 300);
    draw.drawImage(floor, 150, 300);
    draw.drawImage(floor, 200, 300);
    draw.drawImage(floor, 250, 300);
    draw.drawImage(floor, 300, 300);
    draw.drawImage(floor, 350, 300);
    draw.drawImage(floor, 400, 300);
    draw.drawImage(floor, 450, 300);
    draw.drawImage(floor, 0, 350);
    draw.drawImage(floor, 50, 350);
    draw.drawImage(floor, 100, 350);
    draw.drawImage(floor, 150, 350);
    draw.drawImage(floor, 200, 350);
    draw.drawImage(floor, 250, 350);
    draw.drawImage(floor, 300, 350);
    draw.drawImage(floor, 350, 350);
    draw.drawImage(floor, 400, 350);
    draw.drawImage(floor, 450, 350);
    draw.drawImage(floor, 0, 400);
    draw.drawImage(floor, 50, 400);
    draw.drawImage(floor, 100, 400);
    draw.drawImage(floor, 150, 400);
    draw.drawImage(floor, 200, 400);
    draw.drawImage(floor, 250, 400);
    draw.drawImage(floor, 300, 400);
    draw.drawImage(floor, 350, 400);
    draw.drawImage(floor, 400, 400);
    draw.drawImage(floor, 450, 400);
    draw.drawImage(floor, 0, 450);
    draw.drawImage(floor, 50, 450);
    draw.drawImage(floor, 100, 450);
    draw.drawImage(floor, 150, 450);
    draw.drawImage(floor, 200, 450);
    draw.drawImage(floor, 250, 450);
    draw.drawImage(floor, 300, 450);
    draw.drawImage(floor, 350, 450);
    draw.drawImage(floor, 400, 450);
    draw.drawImage(floor, 450, 450);
    if (user.tank != undefined) {
      user.tank.draw();
    }
    if (mo != "n") {
      Game.coins = 0; 
      Game.foes = 0;
      Game.control();
      Game.i();
      user.tank.control();
    }
    if (num == 1) {
      if (mo != "n") {
        spawn(0, 0);
      }
      weak(2, 0, m);
      weak(3, 0, m);
      strong(5, 0, m);
      createAi(6 * 50, 0, m, 3, 3);
      // bomb(7,0, m);
      weak(9, 0, m);
      weak(2, 1, m);
      weak(3, 1, m);
      strong(6, 1, m);
      strong(8, 1, m);
      weak(2, 2, m);
      weak(3, 2, m);
      wall(0, 3, m);
      wall(1, 3, m);
      wall(2, 3, m);
      wall(3, 3, m);
      wall(4, 3, m);
      wall(5, 3, m);
      wall(6, 3, m);
      wall(7, 3, m);
      wall(8, 3, m);
      weak(9, 3, m);
      // chest(200, 1, 4, m);
      wall(3, 4, m);
      wall(6, 4, m);
      createAi(4 * 50, 4 * 50, m, 3, 3);
      // chest(9,4, m);
      wall(3, 5, m);
      strong(4, 5, m);
      strong(5, 5, m);
      wall(6, 5, m);
    }
    if (num === 2) {
      if (mo != "n") {
        user.tank.x = 9*50;
        user.tank.y = 1*50;
      }
      wall(0,0,m);
      wall(0,9,m);
      wall(1,0,m);
      strong(1,1,m);
      strong(1,2,m);
      wall(1,3,m);
      strong(1,4,m);
      strong(1,5,m);
      wall(1,6,m);
      strong(1,7,m);
      strong(1,8,m);
      wall(1,9,m);
      wall(2,0,m);
      wall(2,3,m);
      wall(2,6,m);
      wall(2,9,m);
      wall(3,0,m);
      strong(3,1,m);
      strong(3,2,m);
      wall(3,3,m);
      wall(3,6,m);
      wall(3,9,m);
      wall(4,0,m);
      wall(4,3,m);
      wall(4,6,m);
      wall(4,9,m);
      wall(5,0,m);
      strong(5,1,m);
      strong(5,2,m);
      wall(5,3,m);
      wall(5,6,m);
      wall(5,9,m);
      wall(6,0,m);
      wall(6,3,m);
      wall(6,6,m);
      wall(6,9,m);
      wall(7,0,m);
      strong(7,1,m);
      strong(7,2,m);
      wall(7,3,m);
      wall(7,6,m);
      wall(7,9,m);
      wall(8,0,m);
      wall(8,3,m);
      wall(8,6,m);
      wall(8,9,m);
      wall(9,0,m);
      wall(9,3,m);
      wall(9,4,m);
      wall(9,5,m);
      wall(9,6,m);
      wall(9,7,m);
      wall(9,8,m);
      wall(9,9,m);
      createAi(8*50,4*50,m,3,3);
      createAi(7*50,5*50,m,3,3);
      createAi(6*50,4*50,m,3,3);
      createAi(5*50,8*50,m,3,3);
      createAi(4*50,7*50,m,3,3);
      createAi(3*60,8*50,m,3,3);
    }
    if (num === 3) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 0;
      }
      wall(0,5,m);
      weak(0,7,m);
      weak(1,6,m);
      weak(2,5,m);
      strong(2,6,m);
      wall(3,0,m);
      weak(3,1,m);
      weak(3,2,m);
      weak(3,4,m);
      strong(3,6,m);
      weak(4,3,m);
      strong(4,6,m);
      wall(4,7,m);
      wall(4,8,m);
      wall(4,9,m);
      weak(5,3,m);
      strong(5,6,m);
      wall(5,7,m);
      wall(5,8,m);
      wall(5,9,m);
      wall(6,0,m);
      weak(6,1,m);
      weak(6,2,m);
      weak(6,4,m);
      strong(6,6,m);
      weak(7,5,m);
      strong(7,6,m);
      weak(8,6,m);
      wall(9,5,m);
      weak(9,7,m);
      createAi(0,6*50,m,3,3);
      createAi(2*50,8*50,m,3,3);
      createAi(7*70,8*50,m,3,3);
      createAi(9*50,6*50,m,3,3);
    }
    if (num === 4) {
      if (mo != "n") {
        user.tank.x = 0;
        user.tank.y = 0;
      }
      wall(1,0,m);
      wall(1,1,m);
      wall(1,2,m);
      wall(1,3,m);
      wall(1,4,m);
      wall(1,5,m);
      wall(1,6,m);
      wall(1,7,m);
      wall(1,8,m);
      strong(2,4,m);
      strong(2,5,m);
      strong(2,6,m);
      wall(2,8,m);
      strong(3,0,m);
      strong(3,1,m);
      strong(3,2,m);
      strong(3,4,m);
      strong(3,6,m);
      wall(3,8,m);
      strong(4,4,m);
      strong(4,5,m);
      strong(4,6,m);
      wall(4,8,m);
      weak(5,8,m);
      strong(6,0,m);
      strong(6,1,m);
      strong(6,2,m);
      createAi(6*50,4*50,m,3,3);
      createAi(6*50,5*50,m,3,3);
      createAi(6*50,6*50,m,3,3);
      wall(6,8,m);
      strong(7,0,m);
      strong(7,2,m);
      createAi(7*50,4*40,m,3,3);
      createAi(7*50,6*50,m,3,3);
      wall(7,8,m);
      strong(8,0,m);
      strong(8,1,m);
      strong(8,2,m);
      strong(8,4,m);
      strong(8,5,m);
      strong(8,6,m);
      wall(8,8,m);
      wall(9,0,m);
      wall(9,1,m);
      wall(9,2,m);
      wall(9,3,m);
      wall(9,4,m);
      wall(9,5,m);
      wall(9,6,m);
      wall(9,7,m);
      wall(9,8,m);
      // this level was designed by Adam
    }
    if (num === 5) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 9*50;
      }
      wall(2,2,m);
      wall(2,3,m);
      wall(3,2,m);
      wall(3,3,m);
      weak(3,5,m);
      weak(3,6,m);
      weak(3,7,m);
      createAi(4*50,2*50,m,3,3);
      createAi(4*50,3*50,m,3,3);
      weak(4,4,m);
      weak(4,5,m);
      weak(4,6,m);
      createAi(5*50,2*50,m,3,3);
      createAi(5*50,3*50,m,3,3);
      weak(5,4,m);
      weak(5,5,m);
      weak(5,6,m);
      wall(6,2,m);
      wall(6,3,m);
      weak(6,5,m);
      weak(6,6,m);
      weak(6,7,m);
      wall(7,2,m);
      wall(7,3,m);
    }
    if (num == 6) {
      if (mo != "n") {
        user.tank.x = 50;
        user.tank.y = 50;
      }
      wall(6,6,m);
      wall(6,7,m);
      wall(6,8,m);
      wall(7,6,m);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      strong(7,8,m);
      wall(8,6,m);
      strong(8,7,m);
      strong(8,8,m);
    }
    if (num === 7) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 6*50;
      }
      strong(0,1,m);
      weak(1,0,m);
      weak(1,1,m);
      weak(1,2,m);
      wall(1,6,m);
      wall(1,7,m);
      weak(2,0,m);
      createAi(2*50,50,m,3,3);
      weak(2,2,m);
      wall(2,7,m);
      weak(3,0,m);
      weak(3,1,m);
      weak(3,2,m);
      wall(3,7,m);
      strong(4,1,m);
      wall(4,4,m);
      wall(4,7,m);
      strong(5,1,m);
      wall(5,4,m);
      wall(5,7,m);
      weak(6,0,m);
      weak(6,1,m);
      weak(6,2,m);
      wall(6,7,m);
      weak(7,0,m);
      createAi(7*50,50,m,3,3);
      weak(7,2);
      wall(7,7,m);
      weak(8,0,m);
      weak(8,1,m);
      weak(8,2,m);
      wall(8,6,m);
      wall(8,7,m);
      strong(9,1,m);
    }
    if (num === 8) {
      if (mo != "n") {
        user.tank.x = 2*50;
        user.tank.y = 6*50;
      }
      wall(0,0,m);
      wall(0,1,m);
      wall(0,2,m);
      wall(0,4,m);
      wall(0,5,m);
      wall(0,6,m);
      wall(0,7,m);
      wall(0,8,m);
      wall(1,0,m);
      wall(1,7,m);
      wall(1,8,m);
      wall(2,8,m);
      wall(3,8,m);
      wall(4,8,m);
      wall(5,0,m);
      wall(5,1,m);
      wall(5,2,m);
      strong(5,3,m);
      wall(5,4,m);
      wall(5,5,m);
      wall(5,6,m);
      wall(5,7,m);
      wall(5,8,m);
      wall(6,8,m);
      createAi(7*50,6*50,m,3,3);
      wall(7,8,m);
      wall(8,0,m);
      createAi(8*50,6*50,m,3,3);
      wall(8,7,m);
      wall(8,8,m);
      wall(9,0,m);
      wall(9,1,m);
      wall(9,2,m);
      wall(9,4,m);
      wall(9,5,m);
      wall(9,6,m);
      wall(9,7,m);
      wall(9,8,m);
    }
    if (num === 9) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 3*50;
      }
      createAi(0,4*50,m,3,3);
      createAi(2*50,50,m,3,3);
      createAi(2*50,6*50,m,3,3);
      strong(4,2,m);
      strong(4,3,m);
      strong(4,4,m);
      createAi(5*50,0,m,3,3);
      strong(5,2,m,3,3);
      strong(5,4,m);
      createAi(5*50,9*50,m,3,3);
      createAi(7*50,50,m,3,3);
      createAi(7*50,6*50,m,3,3);
      createAi(9,4,m);
    }
    if (num === 10) {
      if (mo != "n") {
        user.tank.x = 9*50;
        user.tank.y = 9*50;
      }
      //chest(0,0,m);
      strong(1,0,m);
      strong(2,0,m);
      strong(9,0,m);
      strong(0,1,m);
      strong(1,1,m);
      strong(0,2,m);
      strong(2,2,m);
      weak(0,3,m);
      wall(1,3,m);
      wall(8,3,m);
      wall(2,3,m);
      wall(3,3,m);
      wall(4,3,m);
      wall(5,3,m);
      wall(6,3,m);
      wall(7,3,m);
      weak(9,3,m);
      wall(0,5,m);
      wall(1,5,m);
      wall(8,5,m);
      wall(2,5,m);
      wall(3,5,m);
      strong(4,5,m);
      wall(5,5,m);
      wall(6,5,m);
      wall(7,5,m);
      wall(9,5,m);
      weak(0,8,m);
      weak(1,8,m);
      strong(8,8,m);
      weak(2,8,m);
      weak(3,8,m);
      weak(4,8,m);
      strong(5,8,m);
      strong(6,8,m);
      strong(7,8,m);
      strong(9,8,m);
      weak(5,8,m);
      createAi(2*50,1*50,m,3,3);
      createAi(1*50,2*50,m,3,3);
      createAi(0*50,4*50,m,3,3);
      createAi(9*50,4*50,m,3,3);
      createAi(0*50,9*50,m,3,3);
      createAi(4*50,9*50,m,3,3);
    }
    if (num === 11) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 9*50;
      }
      strong(0,6,m);
      strong(1,6,m);
      wall(2,6,m);
      wall(3,6,m);
      strong(4,6,m);
      strong(5,6,m);
      wall(6,6,m);
      wall(7,6,m);
      strong(8,6,m);
      strong(9,6,m);
      strong(3,1,m);
      strong(6,1,m);
      //chest(8,5,m);
      strong(3,3,m);
      strong(6,3,m);
      wall(3,7,m);
      wall(6,7,m);
      wall(6,8,m);
      wall(3,8,m);
      wall(0,9,m);
      wall(9,9,m);
      //chest(7,2,m);
      strong(7,7,m);
      createAi(1*50,1*50,m,3,3);
      createAi(8*50,1*50,m,3,3);
      createAi(1*50,4*50,m,3,3);
      createAi(8*50,4*50,m,3,3);
      createAi(4*50,2*50,m,3,3);
    }
    if (num === 12) {
      if (mo != "n") {
        user.tank.x = 9*50;
        user.tank.y = 0*50;
      }
      strong(0,0,m);
      strong(0,7,m);
      wall(0,8,m);
      wall(1,1,m);
      wall(2,1,m);
      wall(3,1,m);
      wall(4,1,m);
      wall(5,1,m);
      wall(6,1,m);
      wall(8,1,m);
      wall(1,2,m);
      wall(6,2,m);
      wall(8,2,m);
      wall(1,3,m)
      strong(2,3,m);
      wall(6,3,m);
      wall(8,3,m);
      wall(1,4,m);
      wall(4,4,m);
      wall(6,4,m);
      wall(8,4,m);
      wall(1,5,m);
      wall(3,5,m);
      //chest(4,5,m);
      //chest(5,5,m);
      wall(6,5,m);
      wall(8,5,m);
      wall(1,6,m);
      wall(3,6,m);
      wall(4,6,m);
      wall(5,6,m);
      wall(6,6,m);
      wall(8,6,m);
      wall(1,7,m);
      strong(2,7,m);
      strong(7,7,m);
      wall(8,7,m);
      wall(1,8,m);
      wall(2,8,m);
      wall(3,8,m);
      wall(4,8,m);
      wall(5,8,m);
      wall(6,8,m);
      wall(7,8,m);
      wall(8,8,m);
      strong(0,9,m);
      strong(9,9,m);
      createAi(2*50,0*50,m,3,3);
      createAi(7*50,2*50,m,3,3);
      createAi(4*50,3*50,m,3,3);
      createAi(5*50,3*50,m,3,3);
      createAi(0*50,6*50,m,3,3);
      createAi(5*50,7*50,m,3,3);
      createAi(2*50,4*50,m,3,3);
      createAi(7*50,9*50,m,3,3);
    }
    draw.globalAlpha=.5;
    draw.fillStyle="#ffffff";
    draw.font="20px Courier";
    if (num == 1) {
      draw.fillText("Use WASD to move", 50, 370);
      draw.fillText("F to fire", 50, 400);
      draw.fillText("You can break all walls but blue", 50, 430);
    }
    draw.font="20px Courier";
    draw.fillText("Your health: "+user.tank.health, 300,490);
    draw.fillText("Your x:"+user.tank.x+", y:" + user.tank.y, 275, 470);
    draw.globalAlpha = 1;
  }
  function defeat() {
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.font="60px Courier";
    draw.fillStyle = "#ffffff";
    draw.fillText("DEFEAT!",120,120);
    draw.font = "20px Courier";
    draw.fillText("No Stats Updated",140,250);
    setTimeout(mainMenu, 3000);
  }
  function victory() {
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.font="60px Courier";
    draw.fillStyle = "#ffffff";
    draw.fillText("VICTORY!",120,120);
    draw.font = "20px Courier";
    draw.fillText("Coins Gained: "+Game.coins,140,200);
    userData.coins += Game.coins;
    if (userData.level == Game.level) userData.level++;
    var l = 0;
    while (l<JSON.parse(gameData).length) {
      if (JSON.parse(gameData)[l].username==sessionStorage.username) {
        var t = JSON.parse(gameData);
        t[l].coins = userData.coins;
        t[l].level = userData.level;
        storeValue.setItem("gameData", JSON.stringify(t));
      }
      l++;
    }
    draw.fillText("Total Coins: "+userData.coins,140,230);
    setTimeout(mainMenu, 5000);
  }
  function shop() {    
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.fillStyle="#ffffff";
    draw.font="60px Courier";
    draw.fillText("Shop",170,120);
    draw.font="20px Courier";
    draw.fillText("Health Update:",70,200);
    draw.fillRect(300,180,120,60);
    draw.fillText("New Updates Coming Late 2019",80,400);
    draw.fillStyle="#000000";
    draw.fillText("Buy Now",315,215);
    draw.font="15px Courier";
    draw.fillStyle="#ffffff";
    draw.fillText("500 coins for +20 health",70,230);
    draw.fillStyle="#ffffff";
    draw.font="10px Courier";
    draw.fillRect(60,60,90,30);
    draw.fillStyle="#000000";
    draw.fillText("Main Menu", 75, 75);
    document.addEventListener("click", function(e) {
      if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x>60) {
        if (x<140) {
          if (y>60) {
            if (y<90) {
              mainMenu();
            }
          }
        }
      }
      if (x>300) {
        if (x<420) {
          if (y>180) {
            if (y<240) {
              userData.coins -= 500;
              var l = 0;
              while (l<JSON.parse(gameData).length) {
                if (JSON.parse(gameData)[l].username == sessionStorage.username) {
                  var t = JSON.parse(gameData);
                  t[l].health += 20;
                  t[l].coins -= 500;
                  storeValue.setItem("gameData", JSON.stringify(t));
                  a("Health Updated");
                  userData.health += 20;
                }
                l++;
              }
            }
          }
        }
      }
    });
  }
  function mainMenu() {
    document.removeEventListener("keydown", multiplayer1);
    document.removeEventListener("click", multiplayer2);
    user.tank = new Tank();
    window.clearInterval(interval2);
    draw.clearRect(0, 0, 500, 500);
    playText.style.visibility = "hidden";
    draw.fillStyle = "#556B2F";
    draw.fillRect(50, 50, 400, 400);
    draw.fillStyle = "#ffffff";
    draw.fillRect(75, 95, 50, 50);
    draw.font = "15px Courier";
    draw.fillText(user.username, 150, 125);
    draw.fillText("Level:" + userData.level, 325, 125);
    draw.fillText("Coins:" + userData.coins, 75, 190);
    draw.fillText("Controls: WASD movement, F fire, and", 75, 250);
    draw.fillText("arrow keys barrel movement", 75, 270);
    draw.fillRect(190, 350, 120, 50);
    draw.fillRect(70,350,100,50);
    draw.fillRect(330, 350, 100, 50);
    draw.fillStyle = "#000000";
    draw.fillText("Play Levels", 200, 380);
    draw.fillText("Upgrades", 80, 380);
    draw.fillText("Multiplayer", 340, 380);
    document.addEventListener("click", function(e) {
      if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x > 330) {
        if (x < 430) {
          if (y > 350) {
            if (y < 400) {
              multiplayer();
            }
          }
        }
      }
      if (x > 190) {
        if (x < 310) {
          if (y > 350) {
            if (y < 400) {
              levelSelect();
            }
          }
        }
      }
      if (x>70) {
        if (x<170) {
          if (y>350) {
            if (y<400) {
              shop();
            } 
          }
        }
      }
    });
    
  } // main Menu
  function levelSelect(l) {
    draw.fillStyle = "#556B2f";
    draw.fillRect(50, 50, 400, 500);
    draw.fillStyle = "#ffffff";
    draw.fillRect(100, 100, 50, 50);
    if (userData.level < 2) draw.fillStyle="#000000";
    draw.fillRect(200,100,50,50);
    if (userData.level < 3) draw.fillStyle="#000000";
    draw.fillRect(300,100,50,50);
    if (userData.level < 4) draw.fillStyle="#000000";
    draw.fillRect(100,200,50,50);
    if (userData.level < 5) draw.fillStyle="#000000";
    draw.fillRect(200,200,50,50);
    if (userData.level < 6) draw.fillStyle="#000000";
    draw.fillRect(300,200,50,50);
    if (userData.level < 7) draw.fillStyle="#000000";
    draw.fillRect(100,300,50,50);
    if (userData.level < 8) draw.fillStyle="#000000";
    draw.fillRect(200,300,50,50);
    if (userData.level < 9) draw.fillStyle="#000000";
    draw.fillRect(300,300,50,50);
    if (userData.level < 10) draw.fillStyle="#000000"; 
    draw.fillRect(100,400,50,50);
    if (userData.level < 11) draw.fillStyle="#000000";
    draw.fillRect(200,400,50,50);
    if (userData.level < 12) draw.fillStyle="#000000";
    draw.fillRect(300,400,50,50);
    draw.fillStyle = "#000000";
    draw.font = "20px Courier";
    draw.fillText("1",120,130);
    if (userData.level < 2) draw.fillStyle="#A9A9A9";
    draw.fillText("2",220,130);
    if (userData.level < 3) draw.fillStyle="#A9A9A9";
    draw.fillText("3",320,130);
    if (userData.level < 4) draw.fillStyle="#A9A9A9";
    draw.fillText("4",120,230);
    if (userData.level < 5) draw.fillStyle="#A9A9A9";
    draw.fillText("5",220,230);
    if (userData.level < 6) draw.fillStyle="#A9A9A9";
    draw.fillText("6",320,230);
    if (userData.level < 7) draw.fillStyle="#A9A9A9";
    draw.fillText("7",120,330);
    if (userData.level < 8) draw.fillStyle="#A9A9A9";
    draw.fillText("8",220,330);
    if (userData.level < 9) draw.fillStyle="#A9A9A9";
    draw.fillText("9",320,330);
    if (userData.level < 10) draw.fillStyle="#A9A9A9";
    draw.fillText("10",110,430);
    if (userData.level < 11) draw.fillStyle="#A9A9A9";
    draw.fillText("11",210,430);
    if (userData.level < 12) draw.fillStyle="#A9A9A9";
    draw.fillText("12",310,430);
    document.addEventListener("click", levelSelectSupport);
  }
  function levelSelectSupport(e) {
     if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x > 100) {
        if (x < 150) {
          if (y > 100) {
            if (y < 150) {
              Game.level = 1;
              level(1, null, true);
            }
          }
        }
      }
      
      if (x>200) {                  
        if (x<250) {
          if (y>100) {
            if (y<150 && userData.level > 1) {
              Game.level = 2;
              level(2, null, true);
            }
          }
        }
      }
      if (x>300) {
        if (x<350) {
          if (y>100) {
            if (y<150 && userData.level > 2) {
              Game.level = 3;
              level(3, null, true);
            }
          }
        }
      }
      if (x>100) {
        if (x<150) {
          if (y>200) {
            if (y<250 && userData.level > 3) {
              Game.level = 4;
              level(4, null, true);
            }
          }
        }
      }
    if (x>200) {
        if (x<250) {
          if (y>200) {
            if (y<250 && userData.level > 4) {
              Game.level = 5;
              level(5, null, true);
            }
          }
        }
      }
    if (x>300) {
      if (x<350) {
        if (y>200) {
          if (y<250 && userData.level > 5) {
            Game.level = 6;
            level(6, null, true);
          }
        }
      }
    }
    if (x>100) {
      if (x<150) {
        if (y>300) {
          if (y<350 && userData.level > 6) {
            Game.level = 7;
            level(7, null, true);
          }
        }
      }
    }
    if (x>200) {
      if (x<250) {
        if (y>300) {
          if (y<350  && userData.level > 7) {
            Game.level = 8;
            level(8, null, true);
          }
        }
      }
    }
    if (x>300) {
      if (x<350) {
        if (y>300) {
          if (y<350 && userData.level > 8) {
            Game.level = 9;
            level(9, null, true);
          }
        }
      }
    }
    if (x>100) {
      if (x<150) {
        if (y>400) {
          if (y<450 && userData.level > 9) {
            Game.level = 10;
            level(10, null, true);
          }
        }
      }
    }
    if (x>200) {
      if (x<250) {
        if (y>400) {
          if (y<450 && userData.level > 10) {
            Game.level = 11;
            level(11, null, true);
          }
        }
      }
    }
    if (x>300) {
      if (x<350) {
        if (y>400) {
          if (y<450 && userData.level > 11) {
            Game.level = 12;
            level(12, null, true);
          }
        }
      }
    }
  }
  function multiplayer() {
    s=[];
    d=[];
    storeValue.getItem("servers").then(value => sessionStorage.servers = value);
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.fillStyle="#ffffff";
    draw.font="10px Courier";
    draw.fillRect(60,60,90,30);
    draw.fillStyle="#000000";
    draw.fillText("Main Menu", 75, 75);
    draw.font="60px Courier";
    draw.fillStyle="#ffffff";
    draw.fillText("Multiplayer", 55, 150);
    draw.fillRect(150,300,100,50);
    draw.fillRect(260,300,100,50);
    draw.font="20px Courier";
    draw.fillStyle="#000000";
    draw.fillText("Join Game", 150, 330);
    draw.fillText("Host Game", 260, 330);
    draw.font="60px COurier";
    document.addEventListener("keydown", multiplayer1);
    document.addEventListener("click", multiplayer2);
  }
  function multiplayer2(e) {
      if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x>260) {
        if (x<360) {
          if (y>300) {
            if (y<350) {
              if (sessionStorage.servers.includes(s[0]*100+s[1]*10+s[2])) {
                a('Sorry, room is taken');
              } else {
                user.host = new Host();
                user.host.control(s[0]*100+s[1]*10+s[2]);
              }
            }
          }
        }
      }
      if (x>150) {
        if (x<250) {
          if (y>300) {
            if (y<350) {
              //if (sessionStorage.servers.includes(s[0]*100+s[1]*10+s[2])) {
                user.get = new Get();
                user.get.control(s[0]*100+s[1]*10+s[2]);
              //} else {
              //  a("Room not found! Return to Main Menu and back to reload.");
              //}
            }
          }
        }
      }
      if (x>60) {
        if (x<140) {
          if (y>60) {
            if (y<90) {
              mainMenu();
            }
          }
        }
      }
    }
  function multiplayer1(e) {
      if (48 <= e.keyCode && e.keyCode <= 57) {
        s.push(JSON.parse(e.key));
        console.info(s);
      } else if (e.keyCode == 8) {
        s = [];
      }
      var l = 0;
      while (l < 3) {
        if (s[l] == undefined) {
          d[l] = 0;
        } else {
          d[l] = s[l];
        }
        console.info(s+" "+d);
        l++;
      }
      draw.fillStyle="#556B2F";
      draw.fillRect(200,200,200,60);
      draw.fillStyle="#ffffff";
      draw.fillText(d[0]*100+d[1]*10+d[2], 200, 250);
    }
  function wall(x, y, m) {
    if (m) {
      Game.blockId++;
      b[Game.blockId] = new Block(0, x, y, true);
    }
    var l = 1;
    while (l<b.length) {
      if (b[l].x == x) {
        if (b[l].y == y) {
          b[l].wall(x,y);
        }
      }
      l++;
    }
  } // creates a wall
  function strong(x, y, m) {
    if (m) {
      Game.blockId++;
      b[Game.blockId] = new Block(20, x, y, false, false);
    }
    var l = 1;
    while (l<b.length) {
      if (b[l].x == x) {
        if (b[l].y == y) {
          b[l].strong(x,y);
        }
      }
      l++;
    }
  } // creates a strong block
  function spawn(x, y) {
    user.tank.x = x;
    user.tank.y = y;
    user.tank.spawn = [x, y];
  }

  function weak(x, y, m) {
    if (m) {
      Game.blockId++;
      b[Game.blockId] = new Block(10, x, y, false, false);
    }
    var l = 1;
    while (l<b.length) {
      if (b[l].x == x) {
        if (b[l].y == y) {
          b[l].weak(x,y);
        }
      }
      l++;
    }
  }

  function chat_setup() {
    chatSubmit.addEventListener("click", chat_submit);
  }

  function chat_submit() {
    if (message.value != "") {
      if (user.username != undefined) {
        var newMessage = document.createElement("SPAN");
        newMessage.innerHTML = user.username + ": " + message.value + " to: " + to.value;
        sessionStorage.setItem("messages", [user.username, message.value, to.value].concat(sessionStorage.getItem("messages")));
        messages.appendChild(newMessage);
        newMessage.classList.add("message");
        a("Message Sent", "green");
      } else {
        a("Start Game First", "red");
      }
    } else {
      a("Enter Text to Submit", "red");
    }
  }

  function createAi(x, y, m, t, team) {
    if (m) {
      Game.foes++;
      Game.aiId++;
      ai[Game.aiId] = new Ai();
      ai[Game.aiId].id = Game.aiId;
      ai[Game.aiId].x = x;
      ai[Game.aiId].y = y;
      ai[Game.aiId].master = team;
      ai[Game.aiId].type = t;
      ai[Game.aiId].control();
    }
  }
  startScreen();

</script>
<style>
  canvas {
    outline: hidden;
    border: 1px solid black;
    z-index: 1;
  }

  #messages {
    width: 100%;
    height: 100px;
    overflow: auto;
  }

  #message {
    margin-left: 30px;
  }

  #chat_submit {
    background-color: #000000;
    color: white;
    border: 1px #000000;
  }

  h4 {
    color: white;
    margin-bottom: -25px;
    margin-left: 15px;
  }

  .message {
    border: 1px solid black;
    background-color: white;
    color: black;
    display: block;
    font-family: Courier;
  }

  #chat {
    padding: 20px;
    border-top: 30px solid blue;
    border-bottom: 5px solid blue;
    border-left: 5px solid blue;
    border-right: 5px solid blue;
    border-radius: 10px;
    margin-bottom: 5px;
    margin-left: 5px;
  }

  .console {
    animation: alert 8s;
  }

  #play {
    margin-top: -290px;
    margin-left: 120px;
  }

  #playText {
    animation: blink 4s infinite;
    font-size: 20px;
    font-family: Courier;
    z-index: 2;
    position: relative;
  }

  @keyframes blink {
    0% {
      color: #000;
    }

    49% {
      color: transparent;
    }

    50% {
      color: #000;
    }

    99% {
      color: transparent;
    }

    100% {
      color: #000;
    }
  }

  #consoleText {
    color: white;
  }

  #alertConsole {
    z-index: 1000;
    margin-top: 220px;
    position: relative;
  }

  h1 {
    font-family: Courier;
  }

  @keyframes alert {
    0% {
      margin-top: 220px;
    }

    20% {
      margin-top: 120px;
    }

    90% {
      margin-top: 120px;
    }

    100% {
      margin-top: 220px;
    }
  }
  
</style>
</html>
