<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" href="/starlite-logo.png" type="image/png">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132422058-1"></script>
  </head>
  <div id='wall'>
    <div id="animate">
    </div>
  </div>
  <style>
    #wall {
      justify-content: center;
      position: fixed;
      background-color: white;
      width: 100%;
      height: 100%;
      top: 0px;
      left: 0px;
      z-index: 100;
    }
    #animate {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 30px;
      height: 30px;
      margin-top:-15px;
      margin-left:-15px;
      border: 1px solid orangered;
      background-color: orangered;
      border-radius: 15px;
      animation: animation 2s infinite;
      z-index:101;
    }
    @keyframes animation {
      0% {
        margin-left: -15px;
        margin-top: -65px;
      }
      25% {
        margin-left: 35px;
        margin-top: -15px;
        background-color: white;
      }
      50% {
        margin-left: -15px;
        margin-top: 35px;
        background-color: orangered;
      }
      75% {
        margin-left: -65px;
        margin-top: -15px;
        background-color: white;
      }
      100% {
        margin-left: -15px;
        margin-top: -65px;
      }
    }
  </style>
  <script>
    window.setTimeout(function() {
      document.getElementById('wall').style.visibility = 'hidden';
      document.getElementById('animate').style.visibility = 'hidden';
    }, 3000);
  </script>
  <title>Starlite | Increedible Tanks</title>
  </head>
  <div id="game" class="container">
    <h1 id="gameName"> Increedible Tanks </h1>
    <h3 id="views"></h3>
    <h3 id="users"></h3>
    <h2>Under Updates. Please answer this form for free coins: <button id="buttonToForm">Click Here</button></h2>
    <script>
      var buttonToForm = document.getElementById("buttonToForm");
      buttonToForm.addEventListener("click", function() {
        window.open("https://forms.gle/WFGkx8Ns3nG3FnWx6");
      });
    </script>
    <canvas width="500" height="500" id="canvas" tabindex='1'>
      <strong>Canvas is not supported.</strong> Try using a diffrent browser, If that does not work, please restart your device or use a diffrent device. </canvas>
    <iframe src="/chat" width="500" height="500"></iframe>
    <div id="play">
      <h5 id="playText DEACTIVE"></h5>
    </div> 
    <div id="alertConsole">
      <h5 id="consoleText">
      </h5>
    </div>
  </div>
  <style>
    @font-face {
      font-family: 'starfont';
      src: url(http://starlite3.ml/FFFFORWA[1].TTF);
    }
  </style>
  <iframe src="" id="database" visibility="hidden" display="hidden" width="0" height="0"></iframe>
  <script>
  /*var embed = document.getElementById("database");
  var o = [];
  function update(range, value) {
    embed.src="https://script.google.com/macros/s/AKfycbx2j30BqJJTK0igYO2QDtbVvBSwS7JK4BjZ5qeSUdNtONWVApBn/exec?type=2&range="+range+"&value="+value;
  }
  function get(one, two) {
    getUrlJSON("https://spreadsheets.google.com/feeds/list/14CpLkPBcEv44RQwlRohjwgQ7GyVbYciaC7mgKNguuSY/1/public/basic?alt=json");
  }
  function getUrlJSON(url) {
    getJSON(url, after); 
  }
  function after(err, data) {
    if (err !== null) {
      console.log('Something went wrong: ' + err);
    } else {
    var l = 0;
      while (l<data.feed.entry.length) {
        if (data.feed.entry[l].content.$t != "") {
          o.push(data.feed.entry[l].content.$t.split(", ")); 
        }
          l++;
        }
        l = 0;
        while (l<o.length) {
          var q = 0;
            while (q<o[l].length) {
              o[l][q] = o[l][q].split(": ");
              q++;
            }
          l++;
        }
      }
    }
    var getJSON = function(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'json';
      xhr.onload = function() {
        var status = xhr.status;
        if (status === 200) {
          callback(null, xhr.response);
        } else {
          callback(status, xhr.response);
        }
      };
    xhr.send();
  };*/
  var embed = document.getElementById("database");
  function get(username) {
    var xhr = new XMLHttpRequest();
    var url = 'https://starlitedatabase.cs641311.repl.co/?task=get&username='+username;
    xhr.open('GET', url, true);
    xhr.responseType='json';
    xhr.onload=function() {
      if (xhr.status===200) {
        return xhr.response[0];
      } else {
        console.error('DatabaseError: Starlite Database returned a unknown status request.');
      }
    }
  }
  function update(username, key, value) {
    embed.src="https://starlitedatabase.cs641311.repl.co/?task=update&username="+username+"&key="+key+"&value="+value;
  }
  var interval, user, listener, interval2, b = [], s = [], ai = [], l1 = 0, l2 = 0, i = [], Game = new Game(), button = new Image(), gameplay1 = new Image(), red_bullet = new Image(), ai_top = new Image(),  ai_base = new Image(), tank_base_png = new Image(), tank_top_png = new Image(),  start_screen = new Image(), main_menu = new Image(), tank_base2 = new Image(), coins = new Image();
  ai_base.src = "/starlite-tank-base.png";
  tank_top_png.src = "/starlite-tank-top.png";
  tank_base_png.src = "/starlite-tank-base.png";
  ai_top.src = "/starlite-tank-top.png";
  start_screen.src = "/starlite-increedible-tanks-start-screen.png";
  main_menu.src = "/starlite-increedible-tanks-main-menu.png";
  tank_base2.src = "/starlite-tank-base2.png";
  red_bullet.src = "/red-bullet.png";
  coins.src = "/starlite-coin.png";
  button.src = "/button.png";
  gameplay1.src = "/gameplay1.png";
  // initialize music and sounds  
  /*
  var villageMusic = new sound("");
  var menuMusic = new sound("");
  var damageNoise = new sound("");
  var victoryNoise = new sound("");
  var shotNoise = new sound("");
  */
    
  var battleMusic = new sound("http://starlite3.ml/starlite-increedible-tanks-battle-music.mp3");
  var movementNoise = new sound("http://starlite3.ml/starlite-increedible-tanks-tank-movement.mp3");
    
  // function constructor for making sounds
  function sound(src) {
    this.sound = document.createElement("audio");
    this.sound.src = src;
    this.sound.setAttribute("preload", "auto");
    this.sound.setAttribute("controls", "none");
    this.sound.style.display = "none";
    document.body.appendChild(this.sound);
    this.play = function(){
      this.sound.play();
    }
    this.stop = function(){
      this.sound.pause();
    }
  }
  
  function ai_check(x, y) {
    var l = 0;
    while (l < s.length) {
      if (s[l].x > x || s[l].x + 10 > x) {
        if (s[l].x < x + 40 || s[l].x + 10 < x + 40) {
          if (s[l].y > y || s[l].y + 10 > y) {
            if (s[l].y < y + 40 || s[l].y + 10 < y + 40) {
              delete s[l]; // remove object from javascript memory for #lesslag
              s.splice(l, 1); // remove extra undefined from array(leftover from *delete s[l];*)
              return true;
            }
          }
        }
      }
      if (s[l].x < 0 || s[l].x > 500 || s[l].y < 0 || s[l].y > 500) {
        delete s[l];
        s.splice(l, 1);
      }
      l++;
    }
    return false;
  }
  class Hitbox {
    
    constructor(owner, x, y, width, height) {
      this.owner = owner;
      this.width = width;
      this.x = x;
      this.y = y;
    }
    
    detect() {
      for (var l = 0; l < s[l].length; l++) {
        if ((this.x < s[l].x && this.x + this.width > s[l].x) && (this.y < s[l].y && this.y + this.height > s[l].y)) {
          delete s[l];
          s.splice(l, 1);
          this.owner.health -= s[l].damage;
        }
      }
    }
    
  }
    
  class Ai { 
    control() {
      this.health = 200;
      this.Scounter = 0;
      this.Mcounter = 0;
      this.inactive = false;
      this.update = true;
      this.leftright=false;
    }
    draw() {
      if (this.inactive != true) {
        if (this.leftright) {
          draw.translate(this.x + 20, this.y + 20)
          draw.rotate(90 * Math.PI / 180);
          draw.drawImage(tank_base_png, -20, -20);
          draw.rotate(-90 * Math.PI / 180);
          draw.translate((-this.x - 20), (-this.y - 20));
        } else {
          draw.drawImage(tank_base_png, this.x, this.y);
        }
        draw.translate(this.x + 20, this.y + 20);
        draw.rotate(this.rotation * Math.PI / 180);
        draw.drawImage(ai_top, -20, -20);
        draw.rotate(-(this.rotation * Math.PI / 180));
        draw.translate(-this.x - 20, -this.y - 20);
        draw.fillStyle="#000000";
        draw.fillRect(this.x, this.y + 50, 40, 5);
        draw.fillStyle="#FF0000";
        draw.fillRect(this.x+2, this.y+51, 36*this.health/200, 3); 
      }
    }
    move() {
      if (this.Mcounter==10) {
        if (this.inactive != true) {
          if (this.update) {
            this.instructions = this.moveCalc();
          } else {
            this.update = true;
          }
          var xdistance = user.tank.x-this.x;
          var ydistance = user.tank.y-this.y;
          if (xdistance < 300 || ydistance < 300) {
            if (!this.instructions) this.instructions = {};
            this.instructions.fire = true;
          }
          if (this.instructions.up == true) {
            if (checker(this.x - 5, this.y) != false) {
              this.x -= 5;
              this.leftright=true;
            } else {
              if (this.y <= user.tank.y) {
                this.instructions = {left:false, right:true, up:false, down:false};
              } else {
                this.instructions = {right:false, left:true, up:false, down:false};
              }
              this.update = false;
            }
          } else if (this.instructions.down == true) {
            if (checker(this.x + 5, this.y) != false) {
              this.x += 5;
              this.leftright=true;
            } else {
              if (this.y <= user.tank.y) {
                this.instructions = {left:false, right:true, up:false, down:false};
              } else {
                this.instructions = {right:false, left:true, up:false, down:false};
              }
              this.update = false;
            }
          } else if (this.instructions.left == true) {
            if (checker(this.x, this.y - 5) != false) {
              this.y -= 5;
              this.leftright=false;
            } else {
              if (this.x <= user.tank.x) {
                this.instructions = {down:true, up:false, left:false, right:false};
              } else {
                this.instructions = {up:true, down:false, left:false, right:false};
              }
              this.update = false;
            }
          } else if (this.instructions.right == true) {
            if (checker(this.x, this.y + 5) != false) {
              this.y += 5;
              this.leftright=false;
            } else {
              if (this.x <= user.tank.x) {
                this.instructions = {down:true, up:false, right:false, left:false};
              } else {
                this.instructions = {up:true, down:false, right:false, left:false};
              }
              this.update = false;
            }
          }
          if (this.instructions.fire == true) {
            if (this.Scounter == 10) {
              this.fire();
              this.Scounter = 0;
            } else {
              this.Scounter++;
            }
          }
        } else {
          window.clearInterval(this.aiDraw);
        }
        this.Mcounter = 0;
      } else {
        this.Mcounter++;
      }
    }
    fire() {
       var xd = (this.x + 20) - (user.tank.x + 20);
       var yd = (this.y + 20) - (user.tank.y + 20);
       if (xd < 0) {
           var neg = false;
       } else {
           var neg = true;
       }
       if (xd == 0) {
           xd = 1;
       }
       yd = yd/xd;
       xd = 1;
       if (neg) {
           xd = 0-1;
           yd = 0-yd;
       }
       s.push(new Shot(this.x + 20, this.y + 20, s.length-1, xd, yd));
      /*this.xd = 1;
      this.angle = this.rotation % 90;
      this.yd = Math.abs(((this.xd * this.angle) - (90 * this.xd)) / this.angle);
      if (this.rotation < 90 || this.rotation > 270) {
        this.yd = Math.abs(this.yd);
      } else {
        this.yd = 0 - Math.abs(this.yd);
      }
      if (this.rotation > 180) {
        this.xd = Math.abs(this.xd);
      } else {
        this.xd = 0 - Math.abs(this.xd);
      }
      if (this.ydistance > 0 && this.xdistance > 0) {
        this.yd = Math.abs(this.yd);
      }
      if (this.rotation == 0) {
        this.xd = 0;
        this.yd = 1;
      } else if (this.rotation == 90) {
        this.xd = -1;
        this.yd = 0;
      } else if (this.rotation == 180) {
        this.xd = 0;
        this.yd = -1;
      } else if (this.rotation == 270) {
        this.xd = 1;
        this.yd = 0;
      }
      Game.shotId = Game.shotId + 1;
      s[Game.shotId] = new Shot();
      if ((this.xd < 0 && this.yd < 0) || (this.xd > 0 && this.yd > 0)) {
        s[Game.shotId].control(this.x + 20, this.y + 20, Game.shotId, this.yd, this.xd);
      } else {
        s[Game.shotId].control(this.x + 20, this.y + 20, Game.shotId, this.xd, this.yd);
      }*/
    }
    check() {
      if (ai_check(this.x, this.y)) {
        if (this.inactive != true) {
          this.health -= 20;
          if (this.health <= 0) {
            Game.coins += 100;
            Game.foes--;
            this.x = undefined;
            this.y = undefined;
            this.inactive = true;
            if (Game.foes == 0) {
              setTimeout(victory, 20);
              Game.endGame();
            }
          }
        }
      }
    }
    moveCalc() {
      this.xdistance = user.tank.x - this.x;
      this.ydistance = user.tank.y - this.y;
      if (this.xdistance == 0) {
          this.xdistance = 1;
      }
      this.rotation = Math.atan(this.ydistance / this.xdistance) * 180 / Math.PI;
      if (this.xdistance > 0) {
        this.rotation -= 90;
      } else {
        this.rotation += 90;
      }
      if (300 > Math.sqrt(this.xdistance * this.xdistance + this.ydistance * this.ydistance)) {
        var fire = true;
      }
      if (this.xdistance < 300 || this.ydistance < 300) {
        var fire = true;
      }
      if (Math.abs(this.ydistance) > Math.abs(this.xdistance)) {
        if (this.ydistance > 0) {
          return { up: false, down: false, left: false, right: true, fire: fire};
        } else {
          return { up: false, down: false, left: true, right: false, fire: fire };
        }
      } else if (Math.abs(this.xdistance) > Math.abs(this.ydistance)) {
        if (this.xdistance > 0) {
          return { up: false, down: true, left: false, right: false, fire: fire };
        } else {
          return { up: true, down: false, left: false, right: false, fire: fire };
        }
      } else {
        if (this.ydistance < 0) {
          return { left: true, fire: fire };
        } else {
          return { right: true, fire: fire };
        }
      }
    }
  }
  class Shot {
    
    constructor(x, y, id, xm, ym) {
      this.xm = xm;
      this.ym = ym;
      while (this.xm * this.xm + this.ym * this.ym > 1.2 || this.xm * this.xm + this.ym * this.ym < 1) {
        if (this.xm * this.xm + this.ym * this.ym > 1.1) {
          this.xm /= 1.01;
          this.ym /= 1.01;
        }
        if (this.xm * this.xm + this.ym * this.ym < 1.1) {
          this.xm *= 1.01;
          this.ym *= 1.01;
        }
      }
      this.xm = this.xm * 10;
      this.ym = this.ym * 10;
      this.y = y;
      this.x = x;
      while ((this.x < x + 40 && this.x > x - 40) && (this.y < y + 40 && this.y > y - 40)) {	
        this.x = this.x + xm;	
        this.y = this.y + ym;	
      }	
      this.counter = 0;	
      this.id = id;     	
    }

    draw() {	
      // draw the bullet
      draw.drawImage(red_bullet, this.x, this.y);
    }
    
    update() {
      if (this.counter == 1) {
        this.x += this.xm;
        this.y += this.ym;
        this.counter = 0;
      } else {
        this.counter++;
      }
    }
    
  }
  
  function clearShot() {
    if (user.tank != undefined) {
      level(Game.level, "n", false);
    }
  }
    
  function Host() {
    this.control = function(id) {
      document.removeEventListener("keydown", multiplayer1);
      document.removeEventListener("click", multiplayer2);
      this.socket = new WebSocket("wss://connect.websocket.in/v3/"+id+"?apiKey=Li11jOrgHnvR3uXYwoiMrssO3HyOdT5Kme8a0ftuAtVfsJzASYcXf6Amdafo");
      this.socket.onopen = function() {
        a('Mutiplayer Server(room: '+id+') created Sucessfully');
        // store value servers
        user.tank.move = function(e) {
      e = e || event;
      e.preventDefault();
      e.stopImmediatePropagation();
      if (this.inactive == false) {
        if (this.helper[68]) {
          if (checker(this.x + 5, this.y) != false) {
            this.x += 5;
            this.leftright = true;
            // CHASE put in tank_track.play(); here
          }
        }
        if (this.helper[87]) {
          if (checker(this.x, this.y - 5) != false) {
            this.y -= 5;
            this.leftright = false;
            // CHASE put in tank_track.play(); here
          }
        }
        if (this.helper[65]) {
          if (checker(this.x - 5, this.y) != false) {
            this.x -= 5;
            this.leftright = true;
            // CHASE put in tank_track.play(); here
          }
        }
        if (this.helper[83]) {
          if (checker(this.x, this.y + 5) != false) {
            this.y += 5;
            this.leftright = false;
            // CHASE put in tank_track.play(); here
          }
        }
        if (this.helper[70]) {
          if (this.count == 5) {
            this.fire();
            // CHASE put in tank_fire.play(); here
            this.count = 0;
          } else {
            this.count++;
          }
        }
        if (this.helper[39]) {
          if (this.rotation == 355) {
            this.rotation = 0;
          } else {
            this.rotation += 5;
          }
        }
        if (this.helper[37]) {
          if (this.rotation == 0) {
            this.rotation = 355;
          } else {
            this.rotation -= 5;
          }
        }
        //level(Game.level, "n", false);
        var l = 0;
        while (l < ai.length) {
          ai[l].draw();
          l++;
        }
        this.draw();
      } else {
        a("Game is paused", "yellow");
      }
    }
        user.tank.control();
      }
      this.socket.onmessage = function(e) {
        let d = e.data;
        if (d.includes("user ")) {
          let y = d.split("user ");
          alert(JSON.parse(y[1]).rotation);
          this.users.push({x:JSON.parse(y[1]).x,y:JSON.parse(y[1]).y,rotation:JSON.parse(y[1]).rotation,id:JSON.parse(y[1]).id});
          a(JSON.parse(y[1]).id+" has joined the game");
        }
        if (d.includes("update ")) {
          let y = d.split("update ");
          draw.fillRect(JSON.parse(y[1]).x, JSON.parse(y[1]).y, 50, 50);
          this.users[this.users.indexOf(JSON.parse(y[1]).id)].x = x;
          this.users[this.users.indexOf(JSON.parse(y[1]).id)].y = y;
        }
      }
      this.gameControl();
    }
    this.gameControl = function() {
      this.generateLevel();
      window.setInterval(this.draw, 100);
    }
    this.draw = function() {
    draw.clearRect(0, 0, 500, 500);
    draw.fillStyle = "#dcdcdc";
    var floor = new Image();
    floor.src = "/floor.png";
    draw.drawImage(floor, 0, 0);
    draw.drawImage(floor, 50, 0);
    draw.drawImage(floor, 100, 0);
    draw.drawImage(floor, 150, 0);
    draw.drawImage(floor, 200, 0);
    draw.drawImage(floor, 250, 0);
    draw.drawImage(floor, 300, 0);
    draw.drawImage(floor, 350, 0);
    draw.drawImage(floor, 400, 0);
    draw.drawImage(floor, 450, 0);
    draw.drawImage(floor, 0, 50);
    draw.drawImage(floor, 50, 50);
    draw.drawImage(floor, 100, 50);
    draw.drawImage(floor, 150, 50);
    draw.drawImage(floor, 200, 50);
    draw.drawImage(floor, 250, 50);
    draw.drawImage(floor, 300, 50);
    draw.drawImage(floor, 350, 50);
    draw.drawImage(floor, 400, 50);
    draw.drawImage(floor, 450, 50);
    draw.drawImage(floor, 0, 100);
    draw.drawImage(floor, 50, 100);
    draw.drawImage(floor, 100, 100);
    draw.drawImage(floor, 150, 100);
    draw.drawImage(floor, 200, 100);
    draw.drawImage(floor, 250, 100);
    draw.drawImage(floor, 300, 100);
    draw.drawImage(floor, 350, 100);
    draw.drawImage(floor, 400, 100);
    draw.drawImage(floor, 450, 100);
    draw.drawImage(floor, 0, 150);
    draw.drawImage(floor, 50, 150);
    draw.drawImage(floor, 100, 150);
    draw.drawImage(floor, 150, 150);
    draw.drawImage(floor, 200, 150);
    draw.drawImage(floor, 250, 150);
    draw.drawImage(floor, 300, 150);
    draw.drawImage(floor, 350, 150);
    draw.drawImage(floor, 400, 150);
    draw.drawImage(floor, 450, 150);
    draw.drawImage(floor, 0, 200);
    draw.drawImage(floor, 50, 200);
    draw.drawImage(floor, 100, 200);
    draw.drawImage(floor, 150, 200);
    draw.drawImage(floor, 200, 200);
    draw.drawImage(floor, 250, 200);
    draw.drawImage(floor, 300, 200);
    draw.drawImage(floor, 350, 200);
    draw.drawImage(floor, 400, 200);
    draw.drawImage(floor, 450, 200);
    draw.drawImage(floor, 0, 250);
    draw.drawImage(floor, 50, 250);
    draw.drawImage(floor, 100, 250);
    draw.drawImage(floor, 150, 250);
    draw.drawImage(floor, 200, 250);
    draw.drawImage(floor, 250, 250);
    draw.drawImage(floor, 300, 250);
    draw.drawImage(floor, 350, 250);
    draw.drawImage(floor, 400, 250);
    draw.drawImage(floor, 450, 250);
    draw.drawImage(floor, 0, 300);
    draw.drawImage(floor, 50, 300);
    draw.drawImage(floor, 100, 300);
    draw.drawImage(floor, 150, 300);
    draw.drawImage(floor, 200, 300);
    draw.drawImage(floor, 250, 300);
    draw.drawImage(floor, 300, 300);
    draw.drawImage(floor, 350, 300);
    draw.drawImage(floor, 400, 300);
    draw.drawImage(floor, 450, 300);
    draw.drawImage(floor, 0, 350);
    draw.drawImage(floor, 50, 350);
    draw.drawImage(floor, 100, 350);
    draw.drawImage(floor, 150, 350);
    draw.drawImage(floor, 200, 350);
    draw.drawImage(floor, 250, 350);
    draw.drawImage(floor, 300, 350);
    draw.drawImage(floor, 350, 350);
    draw.drawImage(floor, 400, 350);
    draw.drawImage(floor, 450, 350);
    draw.drawImage(floor, 0, 400);
    draw.drawImage(floor, 50, 400);
    draw.drawImage(floor, 100, 400);
    draw.drawImage(floor, 150, 400);
    draw.drawImage(floor, 200, 400);
    draw.drawImage(floor, 250, 400);
    draw.drawImage(floor, 300, 400);
    draw.drawImage(floor, 350, 400);
    draw.drawImage(floor, 400, 400);
    draw.drawImage(floor, 450, 400);
    draw.drawImage(floor, 0, 450);
    draw.drawImage(floor, 50, 450);
    draw.drawImage(floor, 100, 450);
    draw.drawImage(floor, 150, 450);
    draw.drawImage(floor, 200, 450);
    draw.drawImage(floor, 250, 450);
    draw.drawImage(floor, 300, 450);
    draw.drawImage(floor, 350, 450);
    draw.drawImage(floor, 400, 450);
    draw.drawImage(floor, 450, 450);
      let p = 0;
      while (p<this.level.weak.length) {
        this.level.weak[p].weak(this.level.weak[p].x, this.level.weak[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.strong.length) {
        this.level.strong[p].strong(this.level.strong[p].x, this.level.strong[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.wall.length) {
        this.level.wall[p].wall(this.level.wall[p].x, this.level.wall[p].y);
        p++;
      }
      this.sendLevel();
    }.bind(this);
    this.users = [];
    this.generateLevel = function() {
      this.level = {weak:[],strong:[],wall:[],shots:[],users:this.users}
      let p = 0;
      while (p<10) {
        let q = new Block(30, Math.floor(Math.random(9)*10), Math.floor(Math.random(9)*10));
        q.push(s);
        this.level.weak.push(q);
        q.weak();
        p++;
      }
      p = 0;
      while (p<10) {
        let q = new Block(30, Math.floor(Math.random(9)*10), Math.floor(Math.random(9)*10));
        b.push(q);
        this.level.strong.push(q);
        q.strong();
        p++;
      }
      p=0;
      while (p<10) {
        let q = new Block(30, Math.floor(Math.random(9)*10), Math.floor(Math.random(9)*10));
        b.push(q);
        this.level.wall.push(q);
        q.wall();
        p++;
      }
      this.level.users = this.users;
    }
    this.sendLevel = function() {
      this.socket.send("level "+JSON.stringify(this.level));
    }.bind(this);
  }
  function Get() {
    this.control = function(id) {
      document.removeEventListener("keydown", multiplayer1);
      document.removeEventListener("click", multiplayer2);
      this.socket = new WebSocket("wss://connect.websocket.in/v3/"+id+"?apiKey=Li11jOrgHnvR3uXYwoiMrssO3HyOdT5Kme8a0ftuAtVfsJzASYcXf6Amdafo");
      this.socket.onopen = function() {
        a("Successful Joined Room!");
        user.tank.id = sessionStorage.username;
        this.socket.send("user "+user.tank);
        user.tank.move = function(e) {
          e.preventDefault();
          e.stopImmediatePropagation();
          if (this.inactive == false) {
          if (e.code == "KeyD") {
            if (checker(this.x + 5, this.y) != false) {
              this.x += 5;
              this.leftright = true;
              // CHASE put in tank_track.play(); here
            }
          }
          if (e.code == "KeyW") {
            if (checker(this.x, this.y - 5) != false) {
              this.y -= 5;
              this.leftright = false;
              // CHASE put in tank_track.play(); here
            }
          }
          if (e.code == "KeyA") {
            if (checker(this.x - 5, this.y) != false) {
              this.x -= 5;
              this.leftright = true;
              // CHASE put in tank_track.play(); here
            }
          }
          if (e.code == "KeyS") {
            if (checker(this.x, this.y + 5) != false) {
              this.y += 5;
              this.leftright = false;
              // CHASE put in tank_track.play(); here
            }
          }
          if (e.which == 70) {
            if (this.count == 5) {
              this.fire();
              // CHASE put in tank_fire.play(); here
              this.count = 0;
            } else {
              this.count++;
            }
          }
          if (e.which == 37) {
            if (this.rotation == 355) {
              this.rotation = 0;
            } else {
              this.rotation += 5;
            }
          } else if (e.which == 39) {
            if (this.rotation == 0) {
              this.rotation = 355;
             } else {
                this.rotation -= 5;
              }
            }     
          } else {
            a("Game is paused", "yellow");
          }
        }
        user.tank.control();
      }.bind(this);
      this.socket.onmessage = function(e) {
        let d = e.data;
        if (d.includes("level ")) {
          let y = d.split('level ');
          user.get.level = JSON.parse(y[1]);
          let p = 0;
          let o = new Block();
          while (p<user.get.level.weak.length) {
            user.get.level.weak[p].weak = o.weak;
            p++;
          }
          p = 0;
          while (p<user.get.level.strong.length) {
            user.get.level.strong[p].strong = o.strong;
            p++;
          }
          p = 0;
          while (p<user.get.level.wall.length) {
            user.get.level.wall[p].wall = o.wall;
            p++;
          }
          p = 0;
          while (p<user.get.level.users.length) {
            draw.drawImage(tank_base_png, user.get.level.users[p].x, user.get.level.users[p].y);
            draw.drawImage(tank_top_png, user.get.level.users[p].x, user.get.level.users[p].y);
            p++;
          }
          user.get.draw();
          b = user.get.level.weak.concat(user.get.level.strong.concat(user.get.level.wall));
        }
      }
    }.bind(this);
    this.draw = function() {
      let p = 0;
      draw.clearRect(0, 0, 500, 500);
    draw.fillStyle = "#dcdcdc";
    var floor = new Image();
    floor.src = "/floor.png";
    draw.drawImage(floor, 0, 0);
    draw.drawImage(floor, 50, 0);
    draw.drawImage(floor, 100, 0);
    draw.drawImage(floor, 150, 0);
    draw.drawImage(floor, 200, 0);
    draw.drawImage(floor, 250, 0);
    draw.drawImage(floor, 300, 0);
    draw.drawImage(floor, 350, 0);
    draw.drawImage(floor, 400, 0);
    draw.drawImage(floor, 450, 0);
    draw.drawImage(floor, 0, 50);
    draw.drawImage(floor, 50, 50);
    draw.drawImage(floor, 100, 50);
    draw.drawImage(floor, 150, 50);
    draw.drawImage(floor, 200, 50);
    draw.drawImage(floor, 250, 50);
    draw.drawImage(floor, 300, 50);
    draw.drawImage(floor, 350, 50);
    draw.drawImage(floor, 400, 50);
    draw.drawImage(floor, 450, 50);
    draw.drawImage(floor, 0, 100);
    draw.drawImage(floor, 50, 100);
    draw.drawImage(floor, 100, 100);
    draw.drawImage(floor, 150, 100);
    draw.drawImage(floor, 200, 100);
    draw.drawImage(floor, 250, 100);
    draw.drawImage(floor, 300, 100);
    draw.drawImage(floor, 350, 100);
    draw.drawImage(floor, 400, 100);
    draw.drawImage(floor, 450, 100);
    draw.drawImage(floor, 0, 150);
    draw.drawImage(floor, 50, 150);
    draw.drawImage(floor, 100, 150);
    draw.drawImage(floor, 150, 150);
    draw.drawImage(floor, 200, 150);
    draw.drawImage(floor, 250, 150);
    draw.drawImage(floor, 300, 150);
    draw.drawImage(floor, 350, 150);
    draw.drawImage(floor, 400, 150);
    draw.drawImage(floor, 450, 150);
    draw.drawImage(floor, 0, 200);
    draw.drawImage(floor, 50, 200);
    draw.drawImage(floor, 100, 200);
    draw.drawImage(floor, 150, 200);
    draw.drawImage(floor, 200, 200);
    draw.drawImage(floor, 250, 200);
    draw.drawImage(floor, 300, 200);
    draw.drawImage(floor, 350, 200);
    draw.drawImage(floor, 400, 200);
    draw.drawImage(floor, 450, 200);
    draw.drawImage(floor, 0, 250);
    draw.drawImage(floor, 50, 250);
    draw.drawImage(floor, 100, 250);
    draw.drawImage(floor, 150, 250);
    draw.drawImage(floor, 200, 250);
    draw.drawImage(floor, 250, 250);
    draw.drawImage(floor, 300, 250);
    draw.drawImage(floor, 350, 250);
    draw.drawImage(floor, 400, 250);
    draw.drawImage(floor, 450, 250);
    draw.drawImage(floor, 0, 300);
    draw.drawImage(floor, 50, 300);
    draw.drawImage(floor, 100, 300);
    draw.drawImage(floor, 150, 300);
    draw.drawImage(floor, 200, 300);
    draw.drawImage(floor, 250, 300);
    draw.drawImage(floor, 300, 300);
    draw.drawImage(floor, 350, 300);
    draw.drawImage(floor, 400, 300);
    draw.drawImage(floor, 450, 300);
    draw.drawImage(floor, 0, 350);
    draw.drawImage(floor, 50, 350);
    draw.drawImage(floor, 100, 350);
    draw.drawImage(floor, 150, 350);
    draw.drawImage(floor, 200, 350);
    draw.drawImage(floor, 250, 350);
    draw.drawImage(floor, 300, 350);
    draw.drawImage(floor, 350, 350);
    draw.drawImage(floor, 400, 350);
    draw.drawImage(floor, 450, 350);
    draw.drawImage(floor, 0, 400);
    draw.drawImage(floor, 50, 400);
    draw.drawImage(floor, 100, 400);
    draw.drawImage(floor, 150, 400);
    draw.drawImage(floor, 200, 400);
    draw.drawImage(floor, 250, 400);
    draw.drawImage(floor, 300, 400);
    draw.drawImage(floor, 350, 400);
    draw.drawImage(floor, 400, 400);
    draw.drawImage(floor, 450, 400);
    draw.drawImage(floor, 0, 450);
    draw.drawImage(floor, 50, 450);
    draw.drawImage(floor, 100, 450);
    draw.drawImage(floor, 150, 450);
    draw.drawImage(floor, 200, 450);
    draw.drawImage(floor, 250, 450);
    draw.drawImage(floor, 300, 450);
    draw.drawImage(floor, 350, 450);
    draw.drawImage(floor, 400, 450);
    draw.drawImage(floor, 450, 450);
      user.tank.draw();
      draw.fillStyle="#ffffff";
      draw.fillRect(user.tank.x, user.tank.y + 60, sessionStorage.username.length * 15, 20);
      draw.font = "20px starfont";
      draw.fillText(sessionStorage.username, user.tank.x + 5, user.tank.y + 65);
      while (p<this.level.weak.length) {
        this.level.weak[p].weak(this.level.weak[p].x, this.level.weak[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.strong.length) {
        this.level.strong[p].strong(this.level.strong[p].x, this.level.strong[p].y);
        p++;
      }
      p = 0;
      while (p<this.level.wall.length) {
        this.level.wall[p].wall(this.level.wall[p].x, this.level.wall[p].y);
        p++;
      }
      this.socket.send("update "+JSON.stringify({x:user.tank.x, y:user.tank.y, s:s, id:sessionStorage.username}));
    }.bind(this);
  }
  class Tank {
    draw() {
      if (this.leftright == true) {
        draw.translate(this.x + 20, this.y + 20)
        draw.rotate(90 * Math.PI / 180);
        if (this.u > 40) {
          draw.drawImage(tank_base_png, -20, -20);
        } else {
            draw.drawImage(tank_base2, -20, -20);
        }
        draw.rotate(-90 * Math.PI / 180);
        draw.translate((-this.x - 20), (-this.y - 20));
      } else {
        if (this.u > 40) {
            draw.drawImage(tank_base_png, this.x, this.y);
        } else {
            draw.drawImage(tank_base2, this.x, this.y);
        }
      }
      draw.translate(this.x + 20, this.y + 20);
      draw.rotate(this.rotation * Math.PI / 180);
      draw.drawImage(tank_top_png, -20, -20);
      draw.rotate(-(this.rotation * Math.PI / 180));
      draw.translate(-this.x - 20, -this.y - 20);
      // Health Bar!
      draw.fillStyle="#000000";
      draw.fillRect(this.x, this.y + 50, 40, 5);
      draw.fillStyle="#90EE90";
      draw.fillRect(this.x+2, this.y+51, 36*this.health/userData.health, 3); 
    }
    
    check() {
      if (ai_check(this.x, this.y)) {
        this.health -= 20;
        if (this.health <= 0) {
          this.inactive = true;
          window.clearInterval(this.checkloop);
          window.clearInterval(this.interval);
          window.clearInterval(this.interval2)
          this.checkloop = undefined;
          this.interval = undefined;
          this.interval2 = undefined;
          setTimeout(defeat, 20);
          Game.endGame();
        }
      }
    }
    
    initialize() {
      this.speed = 2;
      this.intervals = [];
      this.helper = [];
      this.count = 0;
      this.count2 = 0;
      this.health = userData.health;
      this.r = 0;
      this.x = 0;
      this.y = 0;
      this.u = true;
      this.mode = 0;
      this.color = "#00ff00";
      this.inactive = false;
      this.rotation = 0;
      canvas.focus();
      this.draw();
      /*i.push(window.setInterval(function() {
        user.tank.check();
      }, 50);*/ // type::interval reason::"paused for testing"
      canvas.addEventListener("keydown", tank_listener1, false);
      canvas.addEventListener("keyup", tank_listener2, false);
    }
    
    move(e) {
      e = e || event;
      e.preventDefault();
      e.stopImmediatePropagation();
      if (this.inactive == false) {
        switch (e.keyCode) {
          case 68:
            if (checker(this.x + this.speed, this.y) != false) {
              this.x += this.speed;
              this.leftright = true;
              if (this.u == 80) {
                this.u = 0;
              } else {
                this.u++;
              }
              // CHASE put in tank_track.play(); here
            }
          break;
          case 87:
            if (checker(this.x, this.y - this.speed) != false) {
              this.y -= this.speed;
              this.leftright = false;
              if (this.u == 80) {
                this.u = 0;
              } else {
                this.u++;
              }
              // CHASE put in tank_track.play(); here
            }
          break;
          case 65:
            if (checker(this.x - this.speed, this.y) != false) {
              this.x -= this.speed;
              this.leftright = true;
              if (this.u == 20) {
                this.u = 0;
              } else {
                this.u++;
              }
              // CHASE put in tank_track.play(); here
            }
          break;
          case 83:
            if (checker(this.x, this.y + this.speed) != false) {
              this.y += this.speed;
              this.leftright = false;
              if (this.u == 20) {
                this.u = 0;
              } else {
                this.u++;
              }
              // CHASE put in tank_track.play(); here
            }
          break;
          case 32:
            if (this.count == 30) {
              this.fire();
              // CHASE put in tank_fire.play(); here
              this.count = 0;
            } else {
              this.count++;
            }
          break;
          case 39:
            if (this.count2 == 1) {
              if (this.rotation == 355) {
                this.rotation = 0;
              } else {
                this.rotation += 5;
              }
              this.count2 = 0;
            } else {
              this.count2++;
            }
          break;
          case 37:
            if (this.count2 == 1) {
              if (this.rotation == 0) {
                this.rotation = 355;
              } else {
                this.rotation -= 5;
              }
              this.count2 = 0;
            } else {
              this.count2++;
            }
          break;
        }
      } else {
        a("Game is paused", "yellow");
      }
    }
    
    fire() {
      this.xd = 1;
      this.angle = this.rotation % 90;
      this.yd = Math.abs(((this.xd * this.angle) - (90 * this.xd)) / this.angle);
      if (this.rotation < 90 || this.rotation > 270) {
        this.yd = Math.abs(this.yd);
      } else {
        this.yd = 0 - Math.abs(this.yd);
      }
      if (this.rotation > 180) {
        this.xd = Math.abs(this.xd);
      } else {
        this.xd = 0 - Math.abs(this.xd);
      }
      if (this.rotation == 0) {
        this.xd = 0;
        this.yd = 1;
      } else if (this.rotation == 90) {
        this.xd = -1;
        this.yd = 0;
      } else if (this.rotation == 180) {
        this.xd = 0;
        this.yd = -1;
      } else if (this.rotation == 270) {
        this.xd = 1;
        this.yd = 0;
      }
      if ((this.xd < 0 && this.yd < 0) || (this.xd > 0 && this.yd > 0)) {
        s.push(new Shot(this.x + 20, this.y + 20, s.length-1, this.yd, this.xd));
      } else {
        s.push(new Shot(this.x + 20, this.y + 20, s.length-1, this.xd, this.yd));
      }
    }
  }
    
  function tank_listener1(event) {
    if (event.keyCode == 87 || event.keyCode == 83 || event.keyCode == 68 || event.keyCode == 65) {
      movementNoise.currentTime = 1;
      movementNoise.play();
    }
    if (user.tank.helper[event.keyCode] != true) {
      user.tank.intervals[event.keyCode] = window.setInterval(function() {
        user.tank.move(event, this.speed);
      }, 15);
    }
    user.tank.helper[event.keyCode] = true;
  }
  function tank_listener2(event) {
    if (event.keyCode == 87 || event.keyCode == 83 || event.keyCode == 68 || event.keyCode == 65) {
      if ((user.tank.helper[87] != true && user.tank.helper[83] != true) && (user.tank.helper[68] != true && user.tank.helper[65] != true)) {
        movementNoise.stop();
      } 
    }
    window.clearInterval(user.tank.intervals[event.keyCode]);
    user.tank.helper[event.keyCode] = false;
    tank_tracks.pause();
    tank_tracks.load();
    user.tank.intervals[event.keyCode] = false;
  }
  function checker(x, y) {
    if (x < 0 || y < 0 || x + 40 > 500 || y + 40 > 500) {
      return false;
    }
    // if touching user tank then return "i cant move"
    if ((x + 40 >= user.tank.x && x + 40 <= user.tank.x + 40) || (x >= user.tank.x && x <= user.tank.x + 40)) {
      if ((y + 40 >= user.tank.y && y + 40 <= user.tank.y + 40) || (y >= user.tank.y && y <= user.tank.y + 40)) {
        if ((user.tank.x-user.tank.speed == x || user.tank.x+user.tank.speed == x || user.tank.x == x) && (user.tank.y+user.tank.speed == y || user.tank.y-user.tank.speed == y || user.tank.y == y)) {
        } else {
          return false;
        }
      }
    }
    // if touching Eval Tank then return " i cant move"
    var l = 0;
    while (l < ai.length) {
      if ((x + 40 >= ai[l].x && x + 40 <= ai[l].x + 40) || (x >= ai[l].x && x <= ai[l].x + 40)) {
        if ((y + 40 >= ai[l].y && y + 40 <= ai[l].y + 40) || (y >= ai[l].y && y <= ai[l].y + 40)) {
          if ((x == ai[l].x-5 || x == ai[l].x+5 || ai[l].x == x) && (y == ai[l].y-5 || y == ai[l].y+5 || ai[l].y == y)) {
          } else {
            return false;
          }
        }
      }
      l++;
    }
    // if touching walls then return "i cant move"
    var l = 0;
    while (l < b.length) {
      if ((x + 40 > b[l].x * 50 && x + 40 < b[l].x * 50 + 50) || (x > b[l].x * 50 && x < b[l].x * 50 + 50)) {
        if ((y > b[l].y * 50 && y < b[l].y * 50 + 50) || (y + 40 > b[l].y * 50 && y + 40 < b[l].y * 50 + 50)) {
          return false;
        }
      }
      l++;
    }
    return true;
  }
  function gameHelper() {
    var l = 0;
    while (l < i.length) {
      window.clearInterval(i[l]);
      l++;
    }
    b = [];
    ai = [];
    s = [];
    user.tank = undefined;
  }
  function Game() {
    this.coins = 0;
    this.foes = 0;
    this.paused = false;
    this.aiId = 0;
    this.blockId = 0;
    this.pauseGame = function() {
      document.removeEventListener("click", levelSelectSupport);
      canvas.removeEventListener("keydown", tank_listener1);
      canvas.removeEventListener("keyup", tank_listener2);
      var l = 0;
      while(l<user.tank.intervals.length) {
        if (user.tank.intervals[l]) {
          window.clearInterval(user.tank.intervals[l]);
        }
        l++;
      }
      var l = 0;
      while (l < i.length) {
        window.clearInterval(i[l]);
        l++;
      }
      // still in progress
    }
    this.endGame = function() {
      movementNoise.stop();
      document.removeEventListener("click", levelSelectSupport);
      canvas.removeEventListener("keydown", tank_listener1);
      canvas.removeEventListener("keyup", tank_listener2);
      var l = 0;
      while(l<user.tank.intervals.length) {
        if (user.tank.intervals[l]) {
          window.clearInterval(user.tank.intervals[l]);
        }
        l++;
      }
      gameHelper();
    }
    this.redraw = function() {
      for (var r = 1; r == s.length-1; r++) {
        s[r].redraw();
      }
    }
    this.control = function() {
      canvas.addEventListener("keyup", function(event) {
        if (event.which == 80) {
          if (this.paused == false) {
            this.paused = true;
            user.tank.inactive = true;
          } else {
            this.paused = false;
            user.tank.inactive = false;
          }
          alert(this.paused);
        }
      }, false);
    }
    this.i = function() {
      i.push(window.setInterval(function() {
        clearShot();
      }, 10));
    }
  } 
  function jquery_tank_support(e) {
    user.tank.move(e);
  }
  function Block(health, x, y, isInvincible, isExplosive) {
    this.blockId = b.length-1;
    this.x = x;
    this.y = y;
    this.wall = function(x,y) {
      var wall_image = new Image();
      wall_image.src = "/block-blue.png"
      draw.drawImage(wall_image, x * 50, y * 50);
      if (this.health == undefined) {
        this.health = Infinity;
      }
    }
    this.strong = function(x,y) {
      if (this.health == undefined) {
        this.health = 60;
      }
      draw.strokeStyle = "#000000";
    draw.fillStyle = "#D3D3D3";
    draw.strokeRect(x * 50, y * 50, 50, 50);
    draw.fillRect(x * 50, y * 50, 50, 50);
    draw.beginPath();
    draw.moveTo(x * 50, y * 50);
    draw.lineTo(x * 50 + 10, y * 50 + 10);
    draw.lineTo(x * 50 + 40, y * 50 + 10);
    draw.lineTo(x * 50 + 50, y * 50 + 0);
    draw.stroke();
    draw.moveTo(x * 50, y * 50);
    draw.lineTo(x * 50 + 10, y * 50 + 10);
    draw.lineTo(x * 50 + 10, y * 50 + 40);
    draw.lineTo(x * 50, y * 50 + 50);
    draw.stroke();
    draw.moveTo(x * 50, y * 50 + 50);
    draw.lineTo(x * 50 + 10, y * 50 + 40);
    draw.lineTo(x * 50 + 40, y * 50 + 40);
    draw.lineTo(x * 50 + 50, y * 50 + 50);
    draw.stroke();
    draw.moveTo(x * 50 + 50, y * 50 + 50);
    draw.lineTo(x * 50 + 40, y * 50 + 40);
    draw.lineTo(x * 50 + 40, y * 50 + 10);
    draw.lineTo(x * 50 + 50, y * 50 + 0);
    draw.stroke();
    }
    this.weak = function(x,y) {
      if (this.health == undefined) {
        this.health = 20;
      }
      var weak_image = new Image();
      weak_image.src = "/block-silver.png";
      draw.drawImage(weak_image, x * 50, y * 50);
    }
    /*i.push(window.setInterval(function(id) {
      if (ai_check(b[id].x * 50, b[id].y * 50)) {
        b[id].health -= 10;
        if (b[id].health <= 0) {
          block_support(id);
        }
      }
    }, 50, [this.blockId]));*/
  }
  function block_support(id) {
    b[id].x = undefined;
    b[id].y = undefined;
  }
  var alertConsole = document.getElementById("alertConsole"); // console for game
  var messages = document.getElementById("messages");
  var message = document.getElementById("message");
  var playText = document.getElementById("playText");
  var canvas = document.getElementById("canvas"); // getting the canvas element
  var consoleText = document.getElementById("consoleText"); // text control for console
  var draw = canvas.getContext("2d"); // getting the canvas to be able to draw
  draw.font = "15px starfont";
  draw.fillText("abcdefghijklmnopqrstuvwxyz", 0, 0); // init font
  draw.clearRect(0,0,500,500);
  var tank_tracks = new Audio("/tank-tracks.mp3");
  tank_tracks.load();
  tank_tracks.volume = 0.4;
  function startScreen() {
    draw.drawImage(gameplay1, 0, 0);
    draw.drawImage(button, 100, 300);
    draw.font="40px starfont";
    draw.fillStyle="#ffffff";
    draw.fillText("Increedible", 100, 60);
    draw.fillText("Tanks", 170, 120);
    draw.font="30px starfont";
    draw.fillStyle="#000000";
    draw.fillText("Play", 200, 370);
    document.addEventListener('click', startScreenListener);
  } // startScreen
  function startScreenListener(e) {
    if (e.pageX || e.pageY) {
      x = e.pageX;
      y = e.pageY;
    } else {
      x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
      y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
    }
    x -= canvas.offsetLeft;
    y -= canvas.offsetTop;
    if (x > 100 && x < 400 && y > 300 && y < 400) {
      loading();
    }
  }
  function alert_startup() {
    alertConsole.style.visibility = "hidden";
  } // alert Setup
  function a(m, c) {
    alertConsole.classList.add("console");
    alertConsole.style.backgroundColor = c;
    alertConsole.style.opacity = .7;
    alertConsole.style.border = "1px solid black";
    consoleText.innerHTML = m;
    alertConsole.style.visibility = "visible";
    i.push(window.setInterval(alert_end, 8000));
  } // alert control
  function alert_end() {
    window.clearInterval(interval);
    alertConsole.classList.remove("console");
    alertConsole.style.visibility = "hidden";
  } // alert end
  var userData;
  function loading() {
    battleMusic.play();
    
    if (sessionStorage.username == undefined) {
      var t = confirm("Do you want to play as Guest?");
      if (t) {
        userData = JSON.stringify([{username:"Guest", health:200, coins:0, level:1}]);
        sessionStorage.username = "Guest";
      } else {
        startScreen();
      }
    } else {
      userData = get(sessionStorage.username);
    }
    if (sessionStorage.level == undefined) {   
      user = {
        tank: new Tank(),
        username: sessionStorage.username,
        level: userData.level,
        coins: userData.coins,
      }
    }
    user.tank.health = userData.health;
    draw.clearRect(0, 0, 500, 500);
    a("Loading...");
    playText.style.visibility = "hidden";
    setTimeout(mainMenu(), 5000);
    canvas.removeEventListener("click", loading);
  }
  function levelReader(array, m) {
    for (l = 0; l < array.length; l++) {
      for (q = 0;q < array[l].split("").length; q++) {
        var p = array[l].split(""); // Block key: # = invincible, 1 = weak, 2 = strong, @ = player, A = ai
        if (p[q] == "#") {
          wall(q, l, m);
        }
        if (p[q] == "1") {
          weak(q, l, m);
        }
        if (p[q] == "2") {
          strong(q, l, m);
        }
        if (p[q] == "@") {
          user.tank.x = q*50;
          user.tank.y = l*50;
        }
        if (p[q] == "A") {
          createAi(q*50, l*50,m, 3, 3);
        }
      }
    }
  }
  function level(num, mo, m) {
    draw.clearRect(0, 0, 500, 500);
    draw.fillStyle = "#dcdcdc";
    var floor = new Image();
    floor.src = "/floor.png";
    draw.drawImage(floor, 0, 0);
    draw.drawImage(floor, 50, 0);
    draw.drawImage(floor, 100, 0);
    draw.drawImage(floor, 150, 0);
    draw.drawImage(floor, 200, 0);
    draw.drawImage(floor, 250, 0);
    draw.drawImage(floor, 300, 0);
    draw.drawImage(floor, 350, 0);
    draw.drawImage(floor, 400, 0);
    draw.drawImage(floor, 450, 0);
    draw.drawImage(floor, 0, 50);
    draw.drawImage(floor, 50, 50);
    draw.drawImage(floor, 100, 50);
    draw.drawImage(floor, 150, 50);
    draw.drawImage(floor, 200, 50);
    draw.drawImage(floor, 250, 50);
    draw.drawImage(floor, 300, 50);
    draw.drawImage(floor, 350, 50);
    draw.drawImage(floor, 400, 50);
    draw.drawImage(floor, 450, 50);
    draw.drawImage(floor, 0, 100);
    draw.drawImage(floor, 50, 100);
    draw.drawImage(floor, 100, 100);
    draw.drawImage(floor, 150, 100);
    draw.drawImage(floor, 200, 100);
    draw.drawImage(floor, 250, 100);
    draw.drawImage(floor, 300, 100);
    draw.drawImage(floor, 350, 100);
    draw.drawImage(floor, 400, 100);
    draw.drawImage(floor, 450, 100);
    draw.drawImage(floor, 0, 150);
    draw.drawImage(floor, 50, 150);
    draw.drawImage(floor, 100, 150);
    draw.drawImage(floor, 150, 150);
    draw.drawImage(floor, 200, 150);
    draw.drawImage(floor, 250, 150);
    draw.drawImage(floor, 300, 150);
    draw.drawImage(floor, 350, 150);
    draw.drawImage(floor, 400, 150);
    draw.drawImage(floor, 450, 150);
    draw.drawImage(floor, 0, 200);
    draw.drawImage(floor, 50, 200);
    draw.drawImage(floor, 100, 200);
    draw.drawImage(floor, 150, 200);
    draw.drawImage(floor, 200, 200);
    draw.drawImage(floor, 250, 200);
    draw.drawImage(floor, 300, 200);
    draw.drawImage(floor, 350, 200);
    draw.drawImage(floor, 400, 200);
    draw.drawImage(floor, 450, 200);
    draw.drawImage(floor, 0, 250);
    draw.drawImage(floor, 50, 250);
    draw.drawImage(floor, 100, 250);
    draw.drawImage(floor, 150, 250);
    draw.drawImage(floor, 200, 250);
    draw.drawImage(floor, 250, 250);
    draw.drawImage(floor, 300, 250);
    draw.drawImage(floor, 350, 250);
    draw.drawImage(floor, 400, 250);
    draw.drawImage(floor, 450, 250);
    draw.drawImage(floor, 0, 300);
    draw.drawImage(floor, 50, 300);
    draw.drawImage(floor, 100, 300);
    draw.drawImage(floor, 150, 300);
    draw.drawImage(floor, 200, 300);
    draw.drawImage(floor, 250, 300);
    draw.drawImage(floor, 300, 300);
    draw.drawImage(floor, 350, 300);
    draw.drawImage(floor, 400, 300);
    draw.drawImage(floor, 450, 300);
    draw.drawImage(floor, 0, 350);
    draw.drawImage(floor, 50, 350);
    draw.drawImage(floor, 100, 350);
    draw.drawImage(floor, 150, 350);
    draw.drawImage(floor, 200, 350);
    draw.drawImage(floor, 250, 350);
    draw.drawImage(floor, 300, 350);
    draw.drawImage(floor, 350, 350);
    draw.drawImage(floor, 400, 350);
    draw.drawImage(floor, 450, 350);
    draw.drawImage(floor, 0, 400);
    draw.drawImage(floor, 50, 400);
    draw.drawImage(floor, 100, 400);
    draw.drawImage(floor, 150, 400);
    draw.drawImage(floor, 200, 400);
    draw.drawImage(floor, 250, 400);
    draw.drawImage(floor, 300, 400);
    draw.drawImage(floor, 350, 400);
    draw.drawImage(floor, 400, 400);
    draw.drawImage(floor, 450, 400);
    draw.drawImage(floor, 0, 450);
    draw.drawImage(floor, 50, 450);
    draw.drawImage(floor, 100, 450);
    draw.drawImage(floor, 150, 450);
    draw.drawImage(floor, 200, 450);
    draw.drawImage(floor, 250, 450);
    draw.drawImage(floor, 300, 450);
    draw.drawImage(floor, 350, 450);
    draw.drawImage(floor, 400, 450);
    draw.drawImage(floor, 450, 450);  
    if (mo != "n") {
      Game.coins = 0; 
      Game.foes = 0;
      Game.control();
      Game.i();
      user.tank.initialize();
    }
    // draw tank
    if (user.tank != undefined) {
      user.tank.draw();
      user.tank.check();
    }
    draw.font = "20px starfont";
    draw.fillStyle = "#FFDF00";
    draw.fillText(sessionStorage.username, user.tank.x-sessionStorage.username.length/4*15+5, user.tank.y + 65);
    // draw ai
    var l = 0;
    while (l < ai.length) {
      ai[l].check();
      ai[l].draw();
      ai[l].move();
      l++;
    }
    var l = 0;
    while (l<s.length) {
      s[l].update();
      s[l].draw();
      l++;
    }
    var l = 0;
    while (l<b.length) {
      if (ai_check(b[l].x * 50, b[l].y * 50)) {
        b[l].health -= 10;
        if (b[l].health <= 0) {
          block_support(l);
        }
      }
      l++;
    }
    if (num == 1) {
      if (mo != "n") {
        spawn(0, 0);
      }
      levelReader(['  11 2A  1','  11  2 2','  11      ','#########1','   # A#   ','   #22#   '], m);
    }
    if (num === 2) {
      if (mo != "n") {
        user.tank.x = 9*50;
        user.tank.y = 1*50;
      }
      wall(0,0,m);
      wall(0,9,m);
      wall(1,0,m);
      strong(1,1,m);
      strong(1,2,m);
      wall(1,3,m);
      strong(1,4,m);
      strong(1,5,m);
      wall(1,6,m);
      strong(1,7,m);
      strong(1,8,m);
      wall(1,9,m);
      wall(2,0,m);
      wall(2,3,m);
      wall(2,6,m);
      wall(2,9,m);
      wall(3,0,m);
      strong(3,1,m);
      strong(3,2,m);
      wall(3,3,m);
      wall(3,6,m);
      wall(3,9,m);
      wall(4,0,m);
      wall(4,3,m);
      wall(4,6,m);
      wall(4,9,m);
      wall(5,0,m);
      strong(5,1,m);
      strong(5,2,m);
      wall(5,3,m);
      wall(5,6,m);
      wall(5,9,m);
      wall(6,0,m);
      wall(6,3,m);
      wall(6,6,m);
      wall(6,9,m);
      wall(7,0,m);
      strong(7,1,m);
      strong(7,2,m);
      wall(7,3,m);
      wall(7,6,m);
      wall(7,9,m);
      wall(8,0,m);
      wall(8,3,m);
      wall(8,6,m);
      wall(8,9,m);
      wall(9,0,m);
      wall(9,3,m);
      wall(9,4,m);
      wall(9,5,m);
      wall(9,6,m);
      wall(9,7,m);
      wall(9,8,m);
      wall(9,9,m);
      createAi(8*50,4*50,m,3,3);
      createAi(7*50,5*50,m,3,3);
      createAi(6*50,4*50,m,3,3);
      createAi(5*50,8*50,m,3,3);
      createAi(4*50,7*50,m,3,3);
      createAi(3*60,8*50,m,3,3);
    }
    if (num === 3) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 0;
      }
      wall(0,5,m);
      weak(0,7,m);
      weak(1,6,m);
      weak(2,5,m);
      strong(2,6,m);
      wall(3,0,m);
      weak(3,1,m);
      weak(3,2,m);
      weak(3,4,m);
      strong(3,6,m);
      weak(4,3,m);
      strong(4,6,m);
      wall(4,7,m);
      wall(4,8,m);
      wall(4,9,m);
      weak(5,3,m);
      strong(5,6,m);
      wall(5,7,m);
      wall(5,8,m);
      wall(5,9,m);
      wall(6,0,m);
      weak(6,1,m);
      weak(6,2,m);
      weak(6,4,m);
      strong(6,6,m);
      weak(7,5,m);
      strong(7,6,m);
      weak(8,6,m);
      wall(9,5,m);
      weak(9,7,m);
      createAi(0,6*50,m,3,3);
      createAi(2*50,8*50,m,3,3);
      createAi(7*70,8*50,m,3,3);
      createAi(9*50,6*50,m,3,3);
    }
    if (num === 4) {
      if (mo != "n") {
        user.tank.x = 0;
        user.tank.y = 0;
      }
      wall(1,0,m);
      wall(1,1,m);
      wall(1,2,m);
      wall(1,3,m);
      wall(1,4,m);
      wall(1,5,m);
      wall(1,6,m);
      wall(1,7,m);
      wall(1,8,m);
      strong(2,4,m);
      strong(2,5,m);
      strong(2,6,m);
      wall(2,8,m);
      strong(3,0,m);
      strong(3,1,m);
      strong(3,2,m);
      strong(3,4,m);
      strong(3,6,m);
      wall(3,8,m);
      strong(4,4,m);
      strong(4,5,m);
      strong(4,6,m);
      wall(4,8,m);
      weak(5,8,m);
      strong(6,0,m);
      strong(6,1,m);
      strong(6,2,m);
      createAi(6*50,4*50,m,3,3);
      createAi(6*50,5*50,m,3,3);
      createAi(6*50,6*50,m,3,3);
      wall(6,8,m);
      strong(7,0,m);
      strong(7,2,m);
      createAi(7*50,4*40,m,3,3);
      createAi(7*50,6*50,m,3,3);
      wall(7,8,m);
      strong(8,0,m);
      strong(8,1,m);
      strong(8,2,m);
      strong(8,4,m);
      strong(8,5,m);
      strong(8,6,m);
      wall(8,8,m);
      wall(9,0,m);
      wall(9,1,m);
      wall(9,2,m);
      wall(9,3,m);
      wall(9,4,m);
      wall(9,5,m);
      wall(9,6,m);
      wall(9,7,m);
      wall(9,8,m);
      // this level was designed by Adam
    }
    if (num === 5) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 9*50;
      }
      wall(2,2,m);
      wall(2,3,m);
      wall(3,2,m);
      wall(3,3,m);
      weak(3,5,m);
      weak(3,6,m);
      weak(3,7,m);
      createAi(4*50,2*50,m,3,3);
      createAi(4*50,3*50,m,3,3);
      weak(4,4,m);
      weak(4,5,m);
      weak(4,6,m);
      createAi(5*50,2*50,m,3,3);
      createAi(5*50,3*50,m,3,3);
      weak(5,4,m);
      weak(5,5,m);
      weak(5,6,m);
      wall(6,2,m);
      wall(6,3,m);
      weak(6,5,m);
      weak(6,6,m);
      weak(6,7,m);
      wall(7,2,m);
      wall(7,3,m);
    }
    if (num == 6) {
      if (mo != "n") {
        user.tank.x = 50;
        user.tank.y = 50;
      }
      wall(6,6,m);
      wall(6,7,m);
      wall(6,8,m);
      wall(7,6,m);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      createAi(7*50,7*50,m,3,3);
      strong(7,8,m);
      wall(8,6,m);
      strong(8,7,m);
      strong(8,8,m);
    }
    if (num === 7) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 6*50;
      }
      strong(0,1,m);
      weak(1,0,m);
      weak(1,1,m);
      weak(1,2,m);
      wall(1,6,m);
      wall(1,7,m);
      weak(2,0,m);
      createAi(2*50,50,m,3,3);
      weak(2,2,m);
      wall(2,7,m);
      weak(3,0,m);
      weak(3,1,m);
      weak(3,2,m);
      wall(3,7,m);
      strong(4,1,m);
      wall(4,4,m);
      wall(4,7,m);
      strong(5,1,m);
      wall(5,4,m);
      wall(5,7,m);
      weak(6,0,m);
      weak(6,1,m);
      weak(6,2,m);
      wall(6,7,m);
      weak(7,0,m);
      createAi(7*50,50,m,3,3);
      weak(7,2);
      wall(7,7,m);
      weak(8,0,m);
      weak(8,1,m);
      weak(8,2,m);
      wall(8,6,m);
      wall(8,7,m);
      strong(9,1,m);
    }
    if (num === 8) {
      if (mo != "n") {
        user.tank.x = 2*50;
        user.tank.y = 6*50;
      }
      wall(0,0,m);
      wall(0,1,m);
      wall(0,2,m);
      wall(0,4,m);
      wall(0,5,m);
      wall(0,6,m);
      wall(0,7,m);
      wall(0,8,m);
      wall(1,0,m);
      wall(1,7,m);
      wall(1,8,m);
      wall(2,8,m);
      wall(3,8,m);
      wall(4,8,m);
      wall(5,0,m);
      wall(5,1,m);
      wall(5,2,m);
      strong(5,3,m);
      wall(5,4,m);
      wall(5,5,m);
      wall(5,6,m);
      wall(5,7,m);
      wall(5,8,m);
      wall(6,8,m);
      createAi(7*50,6*50,m,3,3);
      wall(7,8,m);
      wall(8,0,m);
      createAi(8*50,6*50,m,3,3);
      wall(8,7,m);
      wall(8,8,m);
      wall(9,0,m);
      wall(9,1,m);
      wall(9,2,m);
      wall(9,4,m);
      wall(9,5,m);
      wall(9,6,m);
      wall(9,7,m);
      wall(9,8,m);
    }
    if (num === 9) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 3*50;
      }
      createAi(0,4*50,m,3,3);
      createAi(2*50,50,m,3,3);
      createAi(2*50,6*50,m,3,3);
      strong(4,2,m);
      strong(4,3,m);
      strong(4,4,m);
      createAi(5*50,0,m,3,3);
      strong(5,2,m,3,3);
      strong(5,4,m);
      createAi(5*50,9*50,m,3,3);
      createAi(7*50,50,m,3,3);
      createAi(7*50,6*50,m,3,3);
      createAi(9,4,m);
    }
    if (num === 10) {
      if (mo != "n") {
        user.tank.x = 9*50;
        user.tank.y = 9*50;
      }
      //chest(0,0,m);
      strong(1,0,m);
      strong(2,0,m);
      strong(9,0,m);
      strong(0,1,m);
      strong(1,1,m);
      strong(0,2,m);
      strong(2,2,m);
      weak(0,3,m);
      wall(1,3,m);
      wall(8,3,m);
      wall(2,3,m);
      wall(3,3,m);
      wall(4,3,m);
      wall(5,3,m);
      wall(6,3,m);
      wall(7,3,m);
      weak(9,3,m);
      wall(0,5,m);
      wall(1,5,m);
      wall(8,5,m);
      wall(2,5,m);
      wall(3,5,m);
      strong(4,5,m);
      wall(5,5,m);
      wall(6,5,m);
      wall(7,5,m);
      wall(9,5,m);
      weak(0,8,m);
      weak(1,8,m);
      strong(8,8,m);
      weak(2,8,m);
      weak(3,8,m);
      weak(4,8,m);
      strong(5,8,m);
      strong(6,8,m);
      strong(7,8,m);
      strong(9,8,m);
      weak(5,8,m);
      createAi(2*50,1*50,m,3,3);
      createAi(1*50,2*50,m,3,3);
      createAi(0*50,4*50,m,3,3);
      createAi(9*50,4*50,m,3,3);
      createAi(0*50,9*50,m,3,3);
      createAi(4*50,9*50,m,3,3);
    }
    if (num === 11) {
      if (mo != "n") {
        user.tank.x = 5*50;
        user.tank.y = 9*50;
      }
      strong(0,6,m);
      strong(1,6,m);
      wall(2,6,m);
      wall(3,6,m);
      strong(4,6,m);
      strong(5,6,m);
      wall(6,6,m);
      wall(7,6,m);
      strong(8,6,m);
      strong(9,6,m);
      strong(3,1,m);
      strong(6,1,m);
      //chest(8,5,m);
      strong(3,3,m);
      strong(6,3,m);
      wall(3,7,m);
      wall(6,7,m);
      wall(6,8,m);
      wall(3,8,m);
      wall(0,9,m);
      wall(9,9,m);
      //chest(7,2,m);
      strong(7,7,m);
      createAi(1*50,1*50,m,3,3);
      createAi(8*50,1*50,m,3,3);
      createAi(1*50,4*50,m,3,3);
      createAi(8*50,4*50,m,3,3);
      createAi(4*50,2*50,m,3,3);
    }
    if (num === 12) {
      if (mo != "n") {
        user.tank.x = 9*50;
        user.tank.y = 0*50;
      }
      strong(0,0,m);
      strong(0,7,m);
      wall(0,8,m);
      wall(1,1,m);
      wall(2,1,m);
      wall(3,1,m);
      wall(4,1,m);
      wall(5,1,m);
      wall(6,1,m);
      wall(8,1,m);
      wall(1,2,m);
      wall(6,2,m);
      wall(8,2,m);
      wall(1,3,m)
      strong(2,3,m);
      wall(6,3,m);
      wall(8,3,m);
      wall(1,4,m);
      wall(4,4,m);
      wall(6,4,m);
      wall(8,4,m);
      wall(1,5,m);
      wall(3,5,m);
      //chest(4,5,m);
      //chest(5,5,m);
      wall(6,5,m);
      wall(8,5,m);
      wall(1,6,m);
      wall(3,6,m);
      wall(4,6,m);
      wall(5,6,m);
      wall(6,6,m);
      wall(8,6,m);
      wall(1,7,m);
      strong(2,7,m);
      strong(7,7,m);
      wall(8,7,m);
      wall(1,8,m);
      wall(2,8,m);
      wall(3,8,m);
      wall(4,8,m);
      wall(5,8,m);
      wall(6,8,m);
      wall(7,8,m);
      wall(8,8,m);
      strong(0,9,m);
      strong(9,9,m);
      createAi(2*50,0*50,m,3,3);
      createAi(7*50,2*50,m,3,3);
      createAi(4*50,3*50,m,3,3);
      createAi(5*50,3*50,m,3,3);
      createAi(0*50,6*50,m,3,3);
      createAi(5*50,7*50,m,3,3);
      createAi(2*50,4*50,m,3,3);
      createAi(7*50,9*50,m,3,3);
    }
    draw.drawImage(coins, 5, 5);
    draw.fillStyle="#ffffff";
    draw.fillText(Game.coins, 20, 20);
    draw.globalAlpha=.5;
    draw.font="20px starfont";
    if (num == 1) {
      draw.fillText("Use WASD to move", 50, 360);
      draw.fillText("F to fire", 50, 390);
      draw.fillText("You can break all walls but blue", 50, 420);
    }
    if (user.tank != undefined) {
      draw.fillText("Your health: "+user.tank.health, 275,490);
      draw.fillText("Your x:"+user.tank.x+", y:" + user.tank.y, 275, 460);
    }
    draw.globalAlpha = 1;
  }
  var defeatSupport = false;
  function defeat() {
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.font="60px starfont";
    draw.fillStyle = "#ffffff";
    draw.fillText("DEFEAT!",120,120);
    draw.font = "20px starfont";
    draw.fillText("No Stats Updated",140,250);
    document.addEventListener("keydown", defeatHelper);
    setTimeout(function() {
      document.removeEventListener("keydown", defeatHelper);
      if (!defeatSupport) {
        mainMenu();
      } else {
        window.setTimeout(function() {
          defeatSupport = false;
        }, 20);
      }
    }, 3000);
    Game.endGame();
  }
  function defeatHelper(event) {
    if (event.keyCode == 13) {
      defeatSupport = true;
      user.tank = new Tank();
      window.clearInterval(interval2);
      document.removeEventListener("keydown", defeatHelper);
      level(Game.level, null, true);
    }
  }
  var victorySupport = false;
  function victory() {
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.font="60px starfont";
    draw.fillStyle = "#ffffff";
    draw.fillText("VICTORY!",120,120);
    draw.font = "20px starfont";
    draw.fillText("Coins Gained: "+Game.coins,140,200);
    userData.coins += Game.coins;
    if (userData.level == Game.level) userData.level++;
    update(sessionStorage.username, 'playerdata', JSON.stringify(userData));
    draw.fillText("Total Coins: "+userData.coins,140,230);
    document.addEventListener("keydown", victoryHelper);
    setTimeout(function() {
      document.removeEventListener("keydown", victoryHelper);
      if (!victorySupport) {
        mainMenu();
      } else {
        window.setTimeout(function() {
          victorySupport = false;
        }, 20);
      }
    }, 5000);
    Game.endGame();
  }
  function victoryHelper(event) {
    if (event.keyCode == 13) {
      victorySupport = true;
      user.tank = new Tank();
      window.clearInterval(interval2);
      document.removeEventListener("keydown", victoryHelper);
      if (Game.level == 12) {
        level(1, null, true);
      } else {
        Game.level++;
        level(Game.level, null, true);
      }
    }
  }
  function shop() {    
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.fillStyle="#ffffff";
    draw.font="60px starfont";
    draw.fillText("Shop",170,120);
    draw.font="20px starfont";
    draw.fillText("Health Update:",70,200);
    draw.fillRect(300,180,120,60);
    draw.fillText("New Updates Coming Late 2019",80,400);
    draw.fillStyle="#000000";
    draw.fillText("Buy Now",315,215);
    draw.font="15px starfont";
    draw.fillStyle="#ffffff";
    draw.fillText("500 coins for +20 health",70,230);
    draw.fillStyle="#ffffff";
    draw.font="10px starfont";
    draw.fillRect(60,60,90,30);
    draw.fillStyle="#000000";
    draw.fillText("Main Menu", 75, 75);
    document.addEventListener("click", function(e) {
      if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x>60) {
        if (x<140) {
          if (y>60) {
            if (y<90) {
              mainMenu();
            }
          }
        }
      }
      if (x>300) {
        if (x<420) {
          if (y>180) {
            if (y<240) {
              userData.coins -= 500;
              var l = 0;
              while (l<JSON.parse(gameData).length) {
                if (JSON.parse(gameData)[l].username == sessionStorage.username) {
                  var t = JSON.parse(gameData);
                  t[l].health += 20;
                  t[l].coins -= 500;
                  //update("B4", JSON.stringify(t));
                  a("Health Updated");
                  //userData.health += 20;
                }
                l++;
              }
            }
          }
        }
      }
    });
  }
  function mainMenu() {
    document.removeEventListener("click", startScreenListener);
    document.removeEventListener("keydown", multiplayer1);
    document.removeEventListener("click", multiplayer2);
    user.tank = new Tank();
    window.clearInterval(interval2);
    draw.clearRect(0, 0, 500, 500);
    playText.style.visibility = "hidden";
    draw.drawImage(main_menu, 0, 0);
    draw.drawImage(tank_base_png, 75, 120);
    draw.drawImage(tank_top_png, 75, 120);
    draw.fillStyle="#ffffff";
    draw.font = "15px starfont";
    draw.fillText(user.username, 150, 150);
    draw.fillText("Level:" + userData.level, 75, 190);
    draw.drawImage(coins, 310, 140);
    draw.fillText(userData.coins, 325, 150);
    draw.font = "bold 15px starfont";
    draw.fillText("Controls: WASD movement, F fire, and", 75, 250);
    draw.fillText("arrow keys barrel movement", 75, 280);
    draw.fillStyle="#ffffff";
    draw.font = "15px starfont";
    draw.fillRect(190, 350, 120, 50);
    draw.fillRect(70,350,100,50);
    draw.fillRect(330, 350, 100, 50);
    draw.fillStyle = "#000000";
    draw.fillText("Play Levels", 195, 385);
    draw.fillText("Upgrades", 75, 385);
    draw.fillText("#####", 340, 385);
    document.addEventListener("click", function(e) {
      if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x > 330) {
        if (x < 430) {
          if (y > 350) {
            if (y < 400) {
              multiplayer();
            }
          }
        }
      }
      if (x > 190) {
        if (x < 310) {
          if (y > 350) {
            if (y < 400) {
              levelSelect();
            }
          }
        }
      }
      if (x>70) {
        if (x<170) {
          if (y>350) {
            if (y<400) {
              shop();
            } 
          }
        }
      }
    });
    
  } // main Menu
  function levelSelect(l) {
    draw.fillStyle = "#556B2f";
    draw.fillRect(50, 50, 400, 500);
    draw.fillStyle = "#ffffff";
    draw.fillRect(100, 100, 50, 50);
    if (userData.level < 2) draw.fillStyle="#000000";
    draw.fillRect(200,100,50,50);
    if (userData.level < 3) draw.fillStyle="#000000";
    draw.fillRect(300,100,50,50);
    if (userData.level < 4) draw.fillStyle="#000000";
    draw.fillRect(100,200,50,50);
    if (userData.level < 5) draw.fillStyle="#000000";
    draw.fillRect(200,200,50,50);
    if (userData.level < 6) draw.fillStyle="#000000";
    draw.fillRect(300,200,50,50);
    if (userData.level < 7) draw.fillStyle="#000000";
    draw.fillRect(100,300,50,50);
    if (userData.level < 8) draw.fillStyle="#000000";
    draw.fillRect(200,300,50,50);
    if (userData.level < 9) draw.fillStyle="#000000";
    draw.fillRect(300,300,50,50);
    if (userData.level < 10) draw.fillStyle="#000000"; 
    draw.fillRect(100,400,50,50);
    if (userData.level < 11) draw.fillStyle="#000000";
    draw.fillRect(200,400,50,50);
    if (userData.level < 12) draw.fillStyle="#000000";
    draw.fillRect(300,400,50,50);
    draw.fillStyle = "#000000";
    draw.font = "20px starfont";
    draw.fillText("1",120,140);
    if (userData.level < 2) draw.fillStyle="#A9A9A9";
    draw.fillText("2",220,140);
    if (userData.level < 3) draw.fillStyle="#A9A9A9";
    draw.fillText("3",320,140);
    if (userData.level < 4) draw.fillStyle="#A9A9A9";
    draw.fillText("4",120,240);
    if (userData.level < 5) draw.fillStyle="#A9A9A9";
    draw.fillText("5",220,240);
    if (userData.level < 6) draw.fillStyle="#A9A9A9";
    draw.fillText("6",320,240);
    if (userData.level < 7) draw.fillStyle="#A9A9A9";
    draw.fillText("7",120,340);
    if (userData.level < 8) draw.fillStyle="#A9A9A9";
    draw.fillText("8",220,340);
    if (userData.level < 9) draw.fillStyle="#A9A9A9";
    draw.fillText("9",320,340);
    if (userData.level < 10) draw.fillStyle="#A9A9A9";
    draw.fillText("10",110,440);
    if (userData.level < 11) draw.fillStyle="#A9A9A9";
    draw.fillText("11",210,440);
    if (userData.level < 12) draw.fillStyle="#A9A9A9";
    draw.fillText("12",310,440);
    document.addEventListener("click", levelSelectSupport);
  }
  function levelSelectSupport(e) {
     battleMusic.stop();
     if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x > 100) {
        if (x < 150) {
          if (y > 100) {
            if (y < 150) {
              document.removeEventListener("click", levelSelectSupport);
              Game.level = 1;
              level(1, null, true);
            }
          }
        }
      }
      
      if (x>200) {                  
        if (x<250) {
          if (y>100) {
            if (y<150 && userData.level > 1) {
              document.removeEventListener("click", levelSelectSupport);
              Game.level = 2;
              level(2, null, true);
            }
          }
        }
      }
      if (x>300) {
        if (x<350) {
          if (y>100) {
            if (y<150 && userData.level > 2) {
              document.removeEventListener("click", levelSelectSupport);
              Game.level = 3;
              level(3, null, true);
            }
          }
        }
      }
      if (x>100) {
        if (x<150) {
          if (y>200) {
            if (y<250 && userData.level > 3) {
              document.removeEventListener("click", levelSelectSupport);
              Game.level = 4;
              level(4, null, true);
            }
          }
        }
      }
    if (x>200) {
        if (x<250) {
          if (y>200) {
            if (y<250 && userData.level > 4) {
              document.removeEventListener("click", levelSelectSupport);
              Game.level = 5;
              level(5, null, true);
            }
          }
        }
      }
    if (x>300) {
      if (x<350) {
        if (y>200) {
          if (y<250 && userData.level > 5) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 6;
            level(6, null, true);
          }
        }
      }
    }
    if (x>100) {
      if (x<150) {
        if (y>300) {
          if (y<350 && userData.level > 6) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 7;
            level(7, null, true);
          }
        }
      }
    }
    if (x>200) {
      if (x<250) {
        if (y>300) {
          if (y<350  && userData.level > 7) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 8;
            level(8, null, true);
          }
        }
      }
    }
    if (x>300) {
      if (x<350) {
        if (y>300) {
          if (y<350 && userData.level > 8) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 9;
            level(9, null, true);
          }
        }
      }
    }
    if (x>100) {
      if (x<150) {
        if (y>400) {
          if (y<450 && userData.level > 9) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 10;
            level(10, null, true);
          }
        }
      }
    }
    if (x>200) {
      if (x<250) {
        if (y>400) {
          if (y<450 && userData.level > 10) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 11;
            level(11, null, true);
          }
        }
      }
    }
    if (x>300) {
      if (x<350) {
        if (y>400) {
          if (y<450 && userData.level > 11) {
            document.removeEventListener("click", levelSelectSupport);
            Game.level = 12;
            level(12, null, true);
          }
        }
      }
    }
  }
  function multiplayer() {
    s=[];
    d=[];
    get(5,1);
    setTimeout(function(){sessionStorage.servers = JSON.parse(o[5][0][1]);},2000);
    draw.fillStyle="#556B2F";
    draw.fillRect(50,50,400,400);
    draw.fillStyle="#ffffff";
    draw.font="10px starfont";
    draw.fillRect(60,60,90,30);
    draw.fillStyle="#000000";
    draw.fillText("Main Menu", 75, 75);
    draw.font="60px starfont";
    draw.fillStyle="#ffffff";
    draw.fillText("Multiplayer", 55, 150);
    draw.fillRect(150,300,100,50);
    draw.fillRect(260,300,100,50);
    draw.font="20px starfont";
    draw.fillStyle="#000000";
    draw.fillText("Join Game", 150, 330);
    draw.fillText("Host Game", 260, 330);
    draw.font="60px starfont";
    document.addEventListener("keydown", multiplayer1);
    document.addEventListener("click", multiplayer2);
  }
  function multiplayer2(e) {
      if (e.pageX || e.pageY) {
        x = e.pageX;
        y = e.pageY;
      } else {
        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
      }
      x -= canvas.offsetLeft;
      y -= canvas.offsetTop;
      if (x>260) {
        if (x<360) {
          if (y>300) {
            if (y<350) {
              if (sessionStorage.servers.includes(s[0]*100+s[1]*10+s[2])) {
                a('Sorry, room is taken');
              } else {
                user.host = new Host();
                user.host.control(s[0]*100+s[1]*10+s[2]);
              }
            }
          }
        }
      }
      if (x>150) {
        if (x<250) {
          if (y>300) {
            if (y<350) {
              //if (sessionStorage.servers.includes(s[0]*100+s[1]*10+s[2])) {
                user.get = new Get();
                user.get.control(s[0]*100+s[1]*10+s[2]);
              //} else {
              //  a("Room not found! Return to Main Menu and back to reload.");
              //}
            }
          }
        }
      }
      if (x>60) {
        if (x<140) {
          if (y>60) {
            if (y<90) {
              mainMenu();
            }
          }
        }
      }
    }
  function multiplayer1(e) {
      if (48 <= e.keyCode && e.keyCode <= 57) {
        s.push(JSON.parse(e.key));
      } else if (e.keyCode == 8) {
        s = [];
      }
      var l = 0;
      while (l < 3) {
        if (s[l] == undefined) {
          d[l] = 0;
        } else {
          d[l] = s[l];
        }
        l++;
      }
      draw.fillStyle="#556B2F";
      draw.fillRect(200,200,200,60);
      draw.fillStyle="#ffffff";
      draw.fillText(d[0]*100+d[1]*10+d[2], 200, 250);
    }
    
  function wall(x, y, m) {
    if (m) {
      b.push(new Block(0, x, y, true));
    }
    var l = 0;
    while(l<b.length) {
      if (b[l].x == x) {
        if (b[l].y == y) {
          b[l].wall(x,y);
        }
      }
      l++;
    }
  } // creates a wall
  function strong(x, y, m) {
    if (m) {      
      b.push(new Block(20, x, y, false, false));
    }
    var l = 0;
    while (l<b.length) {
      if (b[l].x == x) {
        if (b[l].y == y) {
          b[l].strong(x,y);
        }
      }
      l++;
    }
  } // creates a strong block
  function spawn(x, y) {
    user.tank.x = x;
    user.tank.y = y;
    user.tank.spawn = [x, y];
  }
  function weak(x, y, m) {
    if (m) {
      b.push(new Block(10, x, y, false, false));
    }
    var l = 0;
    while (l<b.length) {
      if (b[l].x == x) {
        if (b[l].y == y) {
          b[l].weak(x,y);
        }
      }
      l++;
    }
  }

  function chat_setup() {
    chatSubmit.addEventListener("click", chat_submit);
  }

  function chat_submit() {
    if (message.value != "") {
      if (user.username != undefined) {
        var newMessage = document.createElement("SPAN");
        newMessage.innerHTML = user.username + ": " + message.value + " to: " + to.value;
        sessionStorage.setItem("messages", [user.username, message.value, to.value].concat(sessionStorage.getItem("messages")));
        messages.appendChild(newMessage);
        newMessage.classList.add("message");
        a("Message Sent", "green");
      } else {
        a("Start Game First", "red");
      }
    } else {
      a("Enter Text to Submit", "red");
    }
  }

  function createAi(x, y, m, t, team) {
    if (m) {
      Game.foes++; // add Eval Tank to Game to detect victory when all destroyed!
      ai.push(new Ai()); // add Eval Tank to array
      ai[ai.length-1].id = ai.length-1;
      ai[ai.length-1].x = x;
      ai[ai.length-1].y = y;
      ai[ai.length-1].master = team;
      ai[ai.length-1].type = t;
      ai[ai.length-1].control();
    }
  }
  window.setTimeout(function() {
    document.getElementById('wall').style.visibility = 'hidden';
    document.getElementById('animate').style.visibility = 'hidden';
    startScreen();
  }, 3000);
  </script>
  <style>
  canvas {
    outline: hidden;
    border: 1px solid black;
    z-index: 1;
  }

  #messages {
    width: 100%;
    height: 100px;
    overflow: auto;
  }

  #message {
    margin-left: 30px;
  }

  #chat_submit {
    background-color: #000000;
    color: white;
    border: 1px #000000;
  }

  h4 {
    color: white;
    margin-bottom: -25px;
    margin-left: 15px;
  }

  .message {
    border: 1px solid black;
    background-color: white;
    color: black;
    display: block;
    font-family: Courier;
  }

  #chat {
    padding: 20px;
    border-top: 30px solid blue;
    border-bottom: 5px solid blue;
    border-left: 5px solid blue;
    border-right: 5px solid blue;
    border-radius: 10px;
    margin-bottom: 5px;
    margin-left: 5px;
  }

  .console {
    animation: alert 8s;
  }

  #play {
    margin-top: -290px;
    margin-left: 120px;
  }

  #playText {
    animation: blink 4s infinite;
    font-size: 20px;
    font-family: Courier;
    z-index: 2;
    position: relative;
  }

  @keyframes blink {
    0% {
      color: #000;
    }

    49% {
      color: transparent;
    }

    50% {
      color: #000;
    }

    99% {
      color: transparent;
    }

    100% {
      color: #000;
    }
  }

  #consoleText {
    color: white;
  }

  #alertConsole {
    z-index: 1000;
    margin-top: 220px;
    position: relative;
  }

  h1 {
    font-family: Courier;
  }

  @keyframes alert {
    0% {
      margin-top: 220px;
    }
    20% {
      margin-top: 120px;
    }

    90% {
      margin-top: 120px;
    }

    100% {
      margin-top: 220px;
    }
  }
  </style>
</html>
